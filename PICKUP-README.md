# 🚗 공항 픽업 시스템 - 2시간 완성 가이드

## 🎯 구현된 기능
- ✅ 한국 출발 → 괌 도착 자동 계산 (날짜 변경 경고)
- ✅ 호텔 픽업 시간 자동 계산 (새벽 비행기 23:59 규칙)
- ✅ 공항→호텔, 호텔→공항, 왕복 3가지 유형
- ✅ 업체별 관리 (투어비스, NOL 등)
- ✅ 기사 전용 화면 (모바일 최적화)
- ✅ 차량 배정 및 준비완료 체크

## 🚀 빠른 시작 (5분)

### 1단계: DB 테이블 생성
```bash
node create-pickup-tables.js
```

### 2단계: 서버 실행
```bash
node server-postgresql.js
```

### 3단계: 테스트

**관리자 화면 (예약 등록):**
```
http://localhost:3000/admin/login
→ 로그인 후
→ http://localhost:3000/pickup
```

**기사 화면 (모바일):**
```
http://localhost:3000/pickup/driver
```

## 📋 테스트 시나리오

### 시나리오 1: 정상 비행기 (날짜 변경 없음)
```
픽업 유형: 공항 → 호텔
한국 출발: 2025-10-15, OZ456 (10:00)
→ 결과: 괌 10/15 13:45 도착 (같은 날)
```

### 시나리오 2: 심야 비행기 (날짜 변경!)
```
픽업 유형: 공항 → 호텔
한국 출발: 2025-10-14, KE123 (22:00)
→ 결과: 괌 10/15 02:00 도착 (다음날!) ⚠️
```

### 시나리오 3: 새벽 출국 (전날 밤 픽업)
```
픽업 유형: 호텔 → 공항
괌 출발: 2025-10-15, KE124 (03:30)
→ 결과: 10/14 23:59 픽업 (전날 밤!) 🌙
```

### 시나리오 4: 정상 출국
```
픽업 유형: 호텔 → 공항
괌 출발: 2025-10-15, OZ456 (17:00)
→ 결과: 10/15 14:00 픽업 (3시간 전)
```

## 🗂️ 파일 구조 (분리 가능)

```
괌세이브카드/
├─ routes/
│  └─ pickup.js ⭐ (복사 가능)
├─ views/
│  └─ pickup/ ⭐ (폴더째 복사 가능)
│     ├─ admin.ejs
│     └─ driver.ejs
├─ create-pickup-tables.js ⭐ (독립 실행)
└─ server-postgresql.js (라우트 2줄만 추가됨)
```

**나중에 분리할 때:**
1. `routes/pickup.js` 복사
2. `views/pickup/` 폴더 복사
3. `create-pickup-tables.js` 복사
4. 새 서버에서 실행!

## 🎨 UI 특징

### 관리자 화면
- 날짜별 전체 예약 관리
- 자동 계산 (날짜/시간)
- 업체별 구분
- 실시간 알림

### 기사 화면
- 오늘 할 일만 표시
- 큰 글자 (모바일 최적화)
- 차량 선택 드롭다운
- 3초마다 자동 새로고침
- 새벽 비행기 특별 표시 (보라색)

## ⚠️ 핵심 규칙

1. **모든 날짜는 괌 기준**
   - 기사는 괌 날짜로만 조회
   - 한국 날짜는 참고용

2. **새벽 비행기 규칙 (00:00-05:59)**
   - 항상 전날 23:59 픽업
   - 공항 조기 도착

3. **정상 비행기 (06:00 이후)**
   - 출발 3시간 전 픽업

## 🔧 커스터마이징

### 비행편 추가
`routes/pickup.js` 파일:
```javascript
const FLIGHTS = {
  'KE111': { time: '07:30', hours: 4 },
  'NEW123': { time: '15:00', hours: 4 }, // ← 추가
};
```

### 호텔 추가
`views/pickup/admin.ejs` 파일:
```html
<datalist id="hotels">
  <option value="Hilton Hotel">
  <option value="New Hotel"> <!-- ← 추가 -->
</datalist>
```

## 📊 API 엔드포인트

```
POST   /pickup/api/create      - 예약 생성
GET    /pickup/api/list        - 날짜별 조회
PUT    /pickup/api/:id/vehicle - 차량 배정
PUT    /pickup/api/:id         - 예약 수정
DELETE /pickup/api/:id          - 예약 취소
GET    /pickup/api/agencies    - 업체 목록
GET    /pickup/api/flights     - 비행편 정보
```

## ✅ 완성 체크리스트

- [ ] DB 테이블 생성 완료
- [ ] 관리자 화면에서 예약 등록
- [ ] 자동 계산 확인 (날짜/시간)
- [ ] 기사 화면에서 목록 확인
- [ ] 차량 선택 및 준비완료 체크
- [ ] 새벽 비행기 규칙 작동 확인
- [ ] 3초 자동 새로고침 확인

## 🚀 배포 (Railway)

```bash
git add .
git commit -m "공항 픽업 시스템 추가"
git push
```

Railway에서 자동 배포됨!

## 💡 Tip

**기사 화면 북마크:**
- 기사에게 `/pickup/driver` URL 전달
- 브라우저 북마크 등록
- 매일 아침 열어서 오늘 할 일 확인!

**실시간 동기화:**
- 한국에서 등록하면
- 괌 기사 화면에 즉시 표시 (3초 내)

---

**개발 완료 시간: 약 2시간**
**분리 가능성: 100%**
**확장성: ⭐⭐⭐⭐⭐**
