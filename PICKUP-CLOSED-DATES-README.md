# 공항픽업 마감날짜 관리 시스템

## 📋 개요

공항픽업 관리 시스템에 특정 날짜의 신규 예약을 마감 처리하는 기능입니다.
마감된 날짜는 달력에 빨간색으로 표시되며, 새 예약 등록 시 경고 메시지가 표시됩니다.

---

## 🚀 설치 및 설정

### 1. 데이터베이스 테이블 생성

```bash
node create-pickup-closed-dates.js
```

이 스크립트는 다음 테이블을 생성합니다:

**pickup_closed_dates 테이블 구조:**
- `id`: 자동 증가 ID (Primary Key)
- `closed_date`: 마감날짜 (DATE, UNIQUE)
- `reason`: 마감 사유 (TEXT)
- `created_by`: 등록자 (VARCHAR)
- `created_at`: 등록일시 (TIMESTAMP)
- `updated_at`: 수정일시 (TIMESTAMP)

---

## 📱 주요 기능

### 1. 마감날짜 등록

**접근 경로:**
- 공항픽업 관리 페이지 → 우측 상단 "마감날짜 관리" 버튼

**등록 방법:**
1. 마감할 날짜 선택
2. 사유 입력 (선택사항)
3. "등록" 버튼 클릭

**특징:**
- 중복 날짜 등록 방지
- 사유는 선택사항 (예: 차량 부족, 연휴 등)
- 등록 즉시 달력에 반영

### 2. 마감날짜 해제

**해제 방법:**
1. 마감날짜 관리 모달에서 해제할 날짜 확인
2. 해당 날짜의 "해제" 버튼 클릭
3. 확인 메시지 확인 후 승인

**특징:**
- 마감 해제 시 즉시 예약 가능 상태로 변경
- 달력에서 마감 표시 제거

### 3. 달력 표시

**마감날짜 시각 표시:**
- 빨간색 배경으로 표시
- 우측 상단에 "🚫 마감" 배지 표시
- 기존 예약이 있어도 마감 표시 유지

### 4. 신규예약 등록 시 경고

**출발일 선택 시:**
- 마감된 날짜 선택 시 빨간색 테두리 표시
- 경고 메시지 표시: "⚠️ 마감된 날짜입니다!"
- 마감 사유가 있는 경우 함께 표시

**예약 가능 여부:**
- 경고가 표시되어도 예약 자체는 가능 (관리자 권한)
- 필요 시 예약 저장 가능

---

## 🔧 API 엔드포인트

### 1. 마감날짜 목록 조회
```
GET /pickup/api/closed-dates
```

**Response:**
```json
{
  "closedDates": [
    {
      "id": 1,
      "closed_date": "2025-12-25",
      "reason": "크리스마스 연휴",
      "created_by": "admin",
      "created_at": "2025-10-16T02:00:00Z"
    }
  ]
}
```

### 2. 특정 날짜 마감 여부 확인
```
GET /pickup/api/closed-dates/check?date=2025-12-25
```

**Response:**
```json
{
  "isClosed": true,
  "data": {
    "id": 1,
    "closed_date": "2025-12-25",
    "reason": "크리스마스 연휴"
  }
}
```

### 3. 마감날짜 등록
```
POST /pickup/api/closed-dates
Content-Type: application/json

{
  "closed_date": "2025-12-25",
  "reason": "크리스마스 연휴"
}
```

**Response:**
```json
{
  "success": true,
  "data": { ... },
  "message": "마감날짜가 등록되었습니다"
}
```

### 4. 마감날짜 삭제 (해제)
```
DELETE /pickup/api/closed-dates/:id
```

**Response:**
```json
{
  "success": true,
  "message": "2025-12-25 마감이 해제되었습니다"
}
```

### 5. 날짜로 마감날짜 삭제
```
DELETE /pickup/api/closed-dates/by-date/2025-12-25
```

---

## 💡 사용 시나리오

### 시나리오 1: 연휴 마감 처리
```
상황: 2025년 1월 1일은 신정으로 픽업 불가
처리:
1. 마감날짜 관리 클릭
2. 날짜: 2025-01-01
3. 사유: 신정 연휴
4. 등록 버튼 클릭
결과: 달력에 빨간색으로 표시, 신규 예약 시 경고
```

### 시나리오 2: 차량 부족
```
상황: 2025년 2월 14일 차량이 모두 배정됨
처리:
1. 마감날짜 관리 클릭
2. 날짜: 2025-02-14
3. 사유: 차량 부족 (만석)
4. 등록 버튼 클릭
결과: 추가 예약 방지
```

### 시나리오 3: 마감 해제
```
상황: 취소 발생으로 2025년 2월 14일 예약 가능
처리:
1. 마감날짜 관리 클릭
2. 2025-02-14 항목의 "해제" 버튼 클릭
3. 확인
결과: 달력에서 마감 표시 제거, 신규 예약 가능
```

---

## ⚙️ 기술 세부사항

### 프론트엔드
- **캐시 시스템**: 마감날짜를 메모리에 캐시하여 빠른 조회
- **실시간 체크**: 출발일 변경 시 즉시 마감 여부 확인
- **시각적 피드백**: 빨간색 테두리, 배경색, 경고 메시지

### 백엔드
- **중복 방지**: UNIQUE 제약조건으로 날짜 중복 방지
- **트랜잭션 처리**: 안전한 등록/삭제
- **에러 처리**: 명확한 에러 메시지

### 데이터베이스
- **인덱스**: closed_date 컬럼에 인덱스 생성 (빠른 조회)
- **타임존**: UTC 기준 저장, 표시 시 로컬 시간 변환

---

## 🔐 권한 관리

현재 마감날짜 관리는 **관리자 전용** 기능입니다.
- 공항픽업 관리 페이지 접근 권한 필요
- 로그인된 관리자만 등록/해제 가능

---

## 📝 주의사항

1. **기존 예약 영향**: 마감 처리 시 기존 예약은 영향받지 않음
2. **관리자 예약**: 마감 날짜에도 관리자는 예약 가능 (긴급 상황 대응)
3. **자동 해제 없음**: 날짜가 지나도 자동으로 해제되지 않음 (수동 관리)
4. **사유 권장**: 마감 사유를 입력하면 나중에 확인 시 유용

---

## 🐛 트러블슈팅

### 마감날짜가 달력에 표시되지 않음
- 브라우저 새로고침 (Ctrl + F5)
- 콘솔에서 `loadClosedDates()` 실행
- 네트워크 탭에서 API 호출 확인

### 마감날짜 등록 시 중복 오류
- 해당 날짜가 이미 마감 처리됨
- 마감날짜 목록에서 기존 항목 확인
- 필요시 해제 후 재등록

### 테이블이 존재하지 않음
```bash
node create-pickup-closed-dates.js
```
위 명령어로 테이블 생성

---

## 🔄 업데이트 로그

### v1.0 (2025-10-16)
- ✅ 마감날짜 등록/해제 기능
- ✅ 달력 시각 표시
- ✅ 신규예약 시 경고 기능
- ✅ API 엔드포인트 5개 구현
- ✅ 캐시 시스템 구현

---

## 📞 지원

문제 발생 시 시스템 관리자에게 문의하세요.
- 에러 메시지 스크린샷
- 수행한 작업 설명
- 브라우저 콘솔 로그
