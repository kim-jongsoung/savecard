# 시즌 관리 시스템 (Season Management System)

## 📋 개요

호텔 객실의 시즌별 요금 체계를 관리하는 시스템입니다.
- **시즌 달력**: 날짜별로 시즌 타입 할당
- **시즌별 요금**: 시즌 × 룸타입별 기본 요금 설정
- **프로모션 요금**: (추후 구현) 실제 예약/정산에 사용될 요금

---

## 🗓️ 1. 시즌 타입 (5가지 고정)

| 코드 | 이름 | 영문명 | 색상 | 설명 |
|------|------|--------|------|------|
| `LOW` | 비수기 (로우시즌) | Low Season | 🟢 녹색 | 가장 저렴한 시즌 |
| `SHOULDER` | 평수기 (숄더시즌) | Shoulder Season | 🔵 하늘색 | 보통 가격 |
| `HIGH` | 성수기 (하이시즌) | High Season | 🟡 노란색 | 비싼 시즌 |
| `PEAK` | 극성수기 (피크시즌) | Peak Season | 🔴 빨간색 | 가장 비싼 시즌 |
| `UNASSIGNED` | 시즌미정 | Unassigned | ⚪ 회색 | 아무 시즌도 아님 |

---

## 📅 2. 시즌 달력 관리

### 접근 경로
```
호텔예약 ERP > 시즌달력
/admin/season-calendar
```

### 기능
- **재고관리와 유사한 달력 UI**
- **6개월 달력 표시**
- **날짜별 시즌 할당**
  - 셀 클릭: 날짜 선택/해제
  - 전체선택/선택해제 버튼
  - 시즌 버튼: 선택된 날짜에 시즌 일괄 적용
  - 저장 버튼: 변경사항 DB 저장

### 사용 예시
```
1. 호텔 선택: 두짓타니 괌 리조트
2. 시작 월: 2025-12
3. 날짜 선택: 12월 20일 ~ 12월 31일 드래그
4. "극성수기" 버튼 클릭
5. 💾 저장
→ 12월 20~31일이 모두 극성수기로 설정됨
```

### 달력 표시
- `L`: 비수기 (Low)
- `S`: 평수기 (Shoulder)
- `H`: 성수기 (High)
- `P`: 극성수기 (Peak)
- `-`: 시즌미정

---

## 💰 3. 시즌별 기본 요금

### 접근 경로
```
호텔예약 ERP > 시즌요금
/admin/season-rates
```

### 기능
- **시즌 × 룸타입 매트릭스 테이블**
- **각 셀에 기본 요금 입력**
- **통화 선택: USD, KRW**
- **변경사항 저장**

### 테이블 구조
```
         | 비수기 | 평수기 | 성수기 | 극성수기 | 시즌미정 |
---------|--------|--------|--------|----------|----------|
디럭스룸  |  $200  |  $250  |  $300  |   $400   |    -     |
스위트룸  |  $350  |  $450  |  $550  |   $700   |    -     |
```

### 중요 안내
⚠️ **여기 입력한 요금은 기본 참고 요금입니다.**  
**실제 예약 및 정산에는 프로모션 요금이 사용됩니다.**

---

## 🔄 4. 시스템 흐름

```
1️⃣ 시즌 달력에서 날짜별 시즌 설정
   예: 2025-12-20 ~ 2025-12-31 = 극성수기

2️⃣ 시즌별 요금에서 각 시즌의 기본 요금 설정
   예: 극성수기 - 디럭스룸 = $400

3️⃣ (추후) 프로모션에서 실제 판매 요금 설정
   예: 크리스마스 특가 - 디럭스룸 = $350
   (시즌 요금 $400을 참고하여 할인 가격 설정)

4️⃣ 예약 시 프로모션 요금 적용
   (기본 요금은 참고만, 실제는 프로모션 요금 사용)
```

---

## 📊 5. 데이터베이스 구조

### `season_types` (시즌 타입 - 고정 5개)
```sql
- id: SERIAL PRIMARY KEY
- season_code: VARCHAR(20) UNIQUE  -- LOW, SHOULDER, HIGH, PEAK, UNASSIGNED
- season_name: VARCHAR(100)        -- 비수기 (로우시즌) 등
- season_name_en: VARCHAR(100)     -- Low Season
- display_order: INTEGER           -- 1, 2, 3, 4, 5
- color_code: VARCHAR(20)          -- #90EE90 등
- is_active: BOOLEAN
```

### `season_calendar` (시즌 달력)
```sql
- id: SERIAL PRIMARY KEY
- hotel_id: INTEGER → hotels(id)
- season_type_id: INTEGER → season_types(id)
- calendar_date: DATE              -- 2025-12-20
- notes: TEXT
- UNIQUE(hotel_id, calendar_date)  -- 한 호텔의 한 날짜는 하나의 시즌만
```

### `season_rates` (시즌별 기본 요금)
```sql
- id: SERIAL PRIMARY KEY
- hotel_id: INTEGER → hotels(id)
- season_type_id: INTEGER → season_types(id)
- room_type_id: INTEGER → room_types(id)
- base_rate: DECIMAL(10,2)         -- 200.00
- currency: VARCHAR(10)            -- USD, KRW
- notes: TEXT
- UNIQUE(hotel_id, season_type_id, room_type_id)
```

---

## 🛠️ 6. API 엔드포인트

### 시즌 타입
```
GET  /api/season-types              - 시즌 타입 목록
```

### 시즌 달력
```
GET  /api/season-calendar            - 월별 시즌 조회
     ?hotel_id=1&year=2025&month=12
POST /api/season-calendar/bulk       - 일괄 등록/수정
     { hotel_id, updates: [{date, season_type_id}] }
DELETE /api/season-calendar          - 삭제
```

### 시즌별 요금
```
GET  /api/season-rates               - 호텔별 요금 조회
     ?hotel_id=1
POST /api/season-rates               - 개별 등록/수정
POST /api/season-rates/bulk          - 일괄 등록/수정
DELETE /api/season-rates/:id         - 삭제
```

---

## 📝 7. 사용 시나리오

### 시나리오 1: 연말연시 극성수기 설정
```
1. 시즌달력 페이지 접속
2. 호텔: 두짓타니 괌 리조트
3. 시작 월: 2025-12
4. 12월 20일 ~ 1월 5일 선택
5. "극성수기" 버튼 클릭
6. 저장 ✅
```

### 시나리오 2: 시즌별 기본 요금 설정
```
1. 시즌요금 페이지 접속
2. 호텔: 두짓타니 괌 리조트
3. 테이블에서 각 시즌별 요금 입력:
   - 디럭스룸 비수기: $200
   - 디럭스룸 평수기: $250
   - 디럭스룸 성수기: $300
   - 디럭스룸 극성수기: $400
4. 저장 ✅
```

### 시나리오 3: (추후) 프로모션 요금 설정
```
1. 프로모션 페이지 접속
2. 신규 프로모션 등록
3. 이름: "크리스마스 특가"
4. 기간: 2025-12-20 ~ 2025-12-26
5. 기본 요금 참조:
   - 디럭스룸 극성수기 기본 요금 = $400
   - 할인 적용: $350 (12.5% 할인)
6. 저장 ✅
```

---

## ⚙️ 8. 설치 및 배포

### 마이그레이션 실행
```bash
# Railway 배포 후 자동 실행 OR
node scripts/run-migration.js 006_create_season_tables.sql
```

### 확인 사항
```sql
-- 시즌 타입 5개 등록 확인
SELECT * FROM season_types ORDER BY display_order;

-- 테이블 생성 확인
\dt season*
```

---

## 🎯 9. 다음 단계 (프로모션 시스템)

현재 구현: 시즌 달력 + 시즌별 기본 요금 ✅

다음 작업:
1. **프로모션 관리 시스템 개선**
   - 시즌 기본 요금 참조
   - 날짜별/기간별 프로모션 요금 설정
   - 복수 프로모션 우선순위 관리
   
2. **예약 시스템 연동**
   - 예약 날짜의 시즌 자동 조회
   - 해당 시즌의 프로모션 요금 적용
   - 프로모션 없으면 기본 요금 사용

3. **정산 시스템 연동**
   - 실제 판매 가격 vs 기본 요금 비교
   - 할인율 자동 계산
   - 수익성 분석

---

## 📌 10. 참고사항

### 재고관리와의 차이점
- **재고관리**: 날짜별 객실 **수량** 관리 (O/X 또는 숫자)
- **시즌관리**: 날짜별 **시즌 타입** 관리 (5가지 시즌 중 1개)

### 요금 우선순위
```
프로모션 요금 > 시즌 기본 요금 > 기본 요금
```

### 주의사항
⚠️ 시즌 달력과 시즌 요금은 **참고용 기본 체계**입니다.  
⚠️ 실제 예약/정산은 반드시 **프로모션 요금**을 사용하세요.

---

**작성일**: 2025-11-14  
**버전**: 1.0.0  
**담당**: 럭스파인드 ERP 시스템
