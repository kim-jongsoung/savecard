# 요금RAG 시스템 테스팅 가이드

## 🎯 테스트 목표
Railway 실서버에서 요금RAG 시스템의 4개 모듈을 순차적으로 테스트하고, 발견된 이슈를 문서화합니다.

---

## 📋 테스트 체크리스트

### ✅ Step 1: 시즌 관리 테스트

#### **1.1 기본 CRUD**
- [ ] 시즌 등록 - 정상 등록 확인
- [ ] 시즌 목록 조회 - 호텔별 필터링
- [ ] 시즌 상세 조회 - 데이터 정확성
- [ ] 시즌 수정 - 정상 수정 및 반영
- [ ] 시즌 삭제 - 정상 삭제

#### **1.2 중첩 시즌 테스트**
- [ ] 큰 시즌 등록 (예: 2025-11-01 ~ 2025-12-31)
- [ ] 작은 시즌 등록 (예: 2025-11-15 ~ 2025-11-20, 우선순위 높게)
- [ ] 중첩 시즌 API 호출 - 겹치는 시즌 정확히 표시되는지
- [ ] 타임라인 뷰 - 중첩 시즌 시각적으로 표시되는지

#### **1.3 검증 로직**
- [ ] 시즌 코드 중복 체크 - 같은 호텔 내 중복 불가
- [ ] 날짜 순서 검증 - 종료일이 시작일보다 늦어야 함
- [ ] 우선순위 정렬 - 높은 우선순위가 먼저 표시

#### **발견된 이슈:**
```
(여기에 기록)
```

---

### ✅ Step 2: 요금 관리 테스트

#### **2.1 기본 CRUD**
- [ ] 요금 등록 - 기본 요금 (시즌 없음)
- [ ] 요금 등록 - 시즌 요금 (시즌 선택)
- [ ] 요금 목록 조회 - 호텔별, 객실별, 시즌별 필터링
- [ ] 요금 수정 - 정상 수정
- [ ] 요금 삭제 - 정상 삭제

#### **2.2 시즌 연동 테스트**
- [ ] 호텔 선택 시 객실 타입 자동 로드
- [ ] 호텔 선택 시 시즌 목록 자동 로드
- [ ] 시즌 선택 시 요금 타입 자동 변경 (season)
- [ ] 시즌 없이 등록 시 기본 요금으로 설정

#### **2.3 중복 체크**
- [ ] 같은 호텔+객실+시즌 조합 중복 등록 시도 - 에러 표시
- [ ] 수정 시 자기 자신은 제외하고 중복 체크

#### **2.4 요금 조회 API 테스트** (`/api/hotel-rates/lookup`)
- [ ] 특정 날짜의 요금 조회 - 시즌 요금 우선
- [ ] 시즌이 없는 날짜 - 기본 요금 반환
- [ ] 등록된 요금이 없는 경우 - 404 반환

#### **발견된 이슈:**
```
(여기에 기록)
```

---

### ✅ Step 3: 프로모션 관리 테스트

#### **3.1 기본 CRUD**
- [ ] 프로모션 등록 - 프로모션 코드, 이름, 기간 설정
- [ ] 프로모션 목록 조회 - 호텔별, 코드 검색
- [ ] 프로모션 상세 조회 - 할인 및 베네핏 정보 포함
- [ ] 프로모션 수정 - 할인/베네핏 재설정
- [ ] 프로모션 삭제 - CASCADE 삭제 확인

#### **3.2 할인 설정 테스트**
- [ ] 호텔 선택 시 객실 타입 자동 로드
- [ ] 객실별 할인 금액 입력
- [ ] 할인이 있는 객실만 저장되는지 확인 (빈 값 제외)

#### **3.3 베네핏 설정 테스트**
- [ ] 베네핏 추가 버튼 - 동적으로 입력폼 추가
- [ ] 베네핏 삭제 버튼 - 정상 삭제
- [ ] 베네핏 타입 선택 (음료쿠폰, 레이트체크아웃 등)
- [ ] 베네핏이 있는 항목만 저장 (빈 값 제외)

#### **3.4 이중 날짜 체크 테스트**
- [ ] 예약 기간 vs 투숙 기간 명확히 구분
- [ ] 예약 기간 종료일 < 시작일 시 에러
- [ ] 투숙 기간 종료일 < 시작일 시 에러

#### **3.5 프로모션 검증 API** (`/api/promotions/validate/:code`)
- [ ] 유효한 프로모션 코드 + 예약일 + 체크인일 → 성공
- [ ] 예약 기간 밖의 예약일 → 실패
- [ ] 투숙 기간 밖의 체크인일 → 실패
- [ ] 비활성 프로모션 → 실패
- [ ] 할인 및 베네핏 정보 정확히 반환

#### **발견된 이슈:**
```
(여기에 기록)
```

---

### ✅ Step 4: 수배피 관리 테스트

#### **4.1 기본 CRUD**
- [ ] 수배피 등록 - 거래처, 호텔, 방식 설정
- [ ] 수배피 목록 조회 - 거래처별, 호텔별 필터링
- [ ] 수배피 상세 조회
- [ ] 수배피 수정
- [ ] 수배피 삭제

#### **4.2 1박당 방식 테스트**
- [ ] 1박당 금액 입력 (예: $10)
- [ ] 저장 후 조회 - 정확히 저장되었는지
- [ ] 방식 변경 시 UI 필드 동적 변경

#### **4.3 정액제 방식 테스트**
- [ ] 1박당 금액, 최대박수, 정액금액 입력
- [ ] 예: $10/박, 3박까지, $30 정액
- [ ] 저장 후 조회

#### **4.4 수배피 계산 API** (`/api/agency-procurement-fees/calculate`)
**1박당 방식 테스트:**
- [ ] 3박 → $10 × 3 = $30
- [ ] 5박 → $10 × 5 = $50

**정액제 방식 테스트:**
- [ ] 설정: $10/박, 3박까지, $30 정액
- [ ] 2박 → $10 × 2 = $20
- [ ] 3박 → $10 × 3 = $30
- [ ] 4박 → $30 (정액 고정)
- [ ] 7박 → $30 (정액 고정)

#### **4.5 우선순위 테스트**
- [ ] 전체 호텔 수배피 등록
- [ ] 특정 호텔 수배피 등록 (같은 거래처)
- [ ] 계산 API - 특정 호텔 수배피가 우선 적용되는지
- [ ] 전체 호텔 수배피만 있을 때 정상 적용되는지

#### **4.6 기간 제한 테스트**
- [ ] 적용 시작일/종료일 설정
- [ ] 기간 내 날짜로 계산 → 정상 적용
- [ ] 기간 외 날짜로 계산 → 적용 안됨

#### **발견된 이슈:**
```
(여기에 기록)
```

---

## 🔍 통합 테스트 시나리오

### 시나리오 1: 일반 예약 (프로모션 없음)
```
1. 호텔 선택: Hotel A
2. 객실 선택: Deluxe Room
3. 체크인: 2025-11-17 (시즌 기간 내)
4. 숙박: 3박

예상 결과:
- 시즌 요금 적용
- 수배피 = 거래처별 설정에 따라 계산
```

### 시나리오 2: 프로모션 예약
```
1. 호텔 선택: Hotel A
2. 프로모션 코드: PROMO2025
3. 체크인: 2026-01-15 (투숙 가능 기간 내)
4. 예약일: 2025-11-20 (예약 가능 기간 내)
5. 숙박: 2박

예상 결과:
- 프로모션 할인 적용
- 베네핏 제공 (음료쿠폰 등)
- 수배피 계산
```

### 시나리오 3: 중첩 시즌 우선순위
```
1. 큰 시즌: 2025-11-01 ~ 12-31 (우선순위 10, 요금 $150)
2. 작은 시즌: 2025-11-15 ~ 11-20 (우선순위 20, 요금 $200)
3. 예약: 2025-11-17 체크인

예상 결과:
- 우선순위 높은 작은 시즌 요금($200) 적용
```

---

## 🐛 이슈 보고 양식

```markdown
### [모듈명] 이슈 제목

**재현 단계:**
1. 
2. 
3. 

**예상 결과:**
- 

**실제 결과:**
- 

**스크린샷/로그:**
(있다면)

**우선순위:** 높음 / 중간 / 낮음
```

---

## 📊 테스트 진행 상황

| 모듈 | 기본 CRUD | 핵심 기능 | 검증 로직 | API 테스트 | 상태 |
|------|-----------|-----------|-----------|------------|------|
| 시즌 관리 | ⬜ | ⬜ | ⬜ | ⬜ | 대기 |
| 요금 관리 | ⬜ | ⬜ | ⬜ | ⬜ | 대기 |
| 프로모션 관리 | ⬜ | ⬜ | ⬜ | ⬜ | 대기 |
| 수배피 관리 | ⬜ | ⬜ | ⬜ | ⬜ | 대기 |

범례: ⬜ 대기 | 🟡 진행중 | ✅ 완료 | ❌ 이슈 발견

---

## 🔧 다음 단계

테스트 완료 후:
1. 발견된 모든 이슈 정리
2. 우선순위별로 이슈 수정
3. 재테스트
4. 예약 시스템 통합 준비

---

**테스트 시작일:** 2025-11-14  
**테스터:** 김종성  
**서버:** Railway Production
