# νΈν…” μ •μ‚°κ΄€λ¦¬ μ‹μ¤ν… TODO λ¦¬μ¤νΈ
μ‘μ„±μΌ: 2025-11-27

## π”΄ κΈ΄κΈ‰ μμ • μ‚¬ν•­ (λ‚΄μΌ μ°μ„  μ²λ¦¬)

### 1. μ •μ‚° λ°μ΄ν„° μ΅°ν μ¤λ¥ μμ •
**λ¬Έμ :**
- μ •μ‚° λ¦¬μ¤νΈμ—μ„ μ‹¤μ  κΈμ•΅μ„ μ λ€λ΅ κ°€μ Έμ¤μ§€ λ»ν•¨
- λ°μ΄ν„°λ² μ΄μ¤ μ»¬λΌκ³Ό ν”„λ΅ νΈμ—”λ“ λ§¤ν•‘ λ¶μΌμΉ

**μμ • ν•„μ”:**
```javascript
// ν„μ¬ λ¬Έμ :
// - item.total_selling_price (grand_totalλ΅ λ§¤ν•‘λ¨)
// - item.total_cost_price (νΈν…” λ§¤μ…μ•΅)
// - item.agency_fee (μλ°°ν”Ό)
// - item.margin (λ°±μ—”λ“μ—μ„ κ³„μ‚°λ κ°’)
// - item.exchange_rate (ν™μ¨)
```

**μ²΄ν¬ ν¬μΈνΈ:**
- [ ] `/api/hotel-settlements` API μ‘λ‹µ λ°μ΄ν„° κµ¬μ΅° ν™•μΈ
- [ ] ν”„λ΅ νΈμ—”λ“ `renderSettlementList` ν•¨μμ λ°μ΄ν„° λ§¤ν•‘ μμ •
- [ ] μ½μ†”μ—μ„ μ‹¤μ  λ°ν™λλ” λ°μ΄ν„° κµ¬μ΅° ν™•μΈ
- [ ] κ° ν•„λ“κ°€ μ¬λ°”λ¥Έ κ°’μ„ ν‘μ‹ν•λ”μ§€ κ²€μ¦

### 2. λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ ν™•μΈ
**ν™•μΈ ν•„μ”:**
- [ ] `hotel_reservations` ν…μ΄λΈ”μ μ •μ‚° κ΄€λ ¨ μ»¬λΌ ν™•μΈ
  - `grand_total` (κ±°λμ•΅ - μΈλ³΄μ΄μ¤/λ°”μ°μ² μ΄μ•΅)
  - `total_cost_price` (νΈν…” λ§¤μ…μ•΅)
  - `agency_fee` (μλ°°ν”Ό)
  - `exchange_rate` (ν™μ¨)
  - `payment_date` (μ…κΈμΌ)
  - `transfer_date` (μ†΅κΈμΌ)
  - `settlement_memo` (μ •μ‚° λ©”λ¨)
  - `margin` (κ³„μ‚°λ λ§μ§„)

### 3. μ•„μ›ƒνΈν…” λ§¤μ…μ•΅ ν•„λ“ μ¶”κ°€
**μ‘μ—…:**
- [ ] `hotel_reservations` ν…μ΄λΈ”μ— `out_hotel_cost` μ»¬λΌ μ¶”κ°€ (DECIMAL)
- [ ] λ°”μ°μ² μƒμ„± μ‹ μ™Έλ¶€ μ•„μ›ƒνΈν…” λΉ„μ© μ €μ¥ λ΅μ§ μ¶”κ°€
- [ ] μ •μ‚° APIμ—μ„ `out_hotel_cost` λ°ν™ν•λ„λ΅ μμ •
- [ ] ν”„λ΅ νΈμ—”λ“μ—μ„ μ•„μ›ƒνΈν…” λ§¤μ…μ•΅ ν‘μ‹

### 4. λ§μ§„ λ° λ¶€κ°€μ„Έ κ³„μ‚° λ΅μ§ κ²€μ¦
**ν„μ¬ λ΅μ§:**
```javascript
// μλ°°ν”Ό(λ§μ§„) = κ±°λμ•΅(KRW) - νΈν…”λ§¤μ…μ•΅(KRW) - μ•„μ›ƒνΈν…”λ§¤μ…μ•΅(KRW) - μλ°°ν”Ό(KRW)
// λ¶€κ°€μ„Έ = (λ§μ§„ Γ— 10%) - (μλ°°ν”Ό Γ— 10%)
```

**ν™•μΈ ν•„μ”:**
- [ ] λ°±μ—”λ“μ—μ„ κ³„μ‚°λ `margin` κ°’μ΄ μ¬λ°”λ¥Έμ§€ ν™•μΈ
- [ ] ν”„λ΅ νΈμ—”λ“ κ³„μ‚° λ΅μ§κ³Ό λ°±μ—”λ“ κ³„μ‚° λ΅μ§ μΌμΉ μ—¬λ¶€ ν™•μΈ
- [ ] λ¶€κ°€μ„Έ κ³„μ‚° κ³µμ‹ μ¬κ²€ν† 

---

## π΅ μ¤‘μ” κ°μ„  μ‚¬ν•­

### 5. μ •μ‚° μ΄κ΄€ ν”„λ΅μ„Έμ¤ κ°μ„ 
**ν„μ¬ μƒνƒ:**
- β… μλ°°κ΄€λ¦¬μ—μ„ "μ •μ‚°" λ²„νΌ ν΄λ¦­ μ‹ μ΄κ΄€ λ¨λ‹¬ μ¤ν”
- β… μ¤λ ν™μ¨ μλ™ μ΅°ν
- β… μ½κΈ° μ „μ© ν™•μΈ λ¨λ‹¬

**μ¶”κ°€ ν•„μ”:**
- [ ] μΈλ³΄μ΄μ¤/λ°”μ°μ²μ—μ„ κ±°λμ•΅(USD) μλ™ μ¶”μ¶
- [ ] νΈν…” μΈλ³΄μ΄μ¤μ—μ„ νΈν…”λ§¤μ…μ•΅(USD) μλ™ μ¶”μ¶
- [ ] λ°”μ°μ²μ—μ„ μ•„μ›ƒνΈν…” λ§¤μ…μ•΅(USD) μλ™ μ¶”μ¶
- [ ] μλ°°ν”Ό μλ™ κ³„μ‚° (ν„μ¬λ” μλ™ μ…λ ¥)

### 6. μ •μ‚° λ¦¬μ¤νΈ ν΄λ¦­ λ™μ‘ κ°μ„ 
**ν„μ¬ μƒνƒ:**
- β… μ •μ‚° λ¦¬μ¤νΈ ν΄λ¦­ μ‹ μλ°°κ΄€λ¦¬ νμ΄μ§€λ΅ μ΄λ™
- β… μμ•½ μμ • λ¨λ‹¬ μλ™ μ¤ν”

**κ°μ„  ν•„μ”:**
- [ ] μƒ νƒ­μ—μ„ μ—΄κΈ° μµμ… μ¶”κ°€
- [ ] λ’¤λ΅κ°€κΈ° μ‹ μ •μ‚° νμ΄μ§€λ΅ μλ™ λ³µκ·€
- [ ] λ¨λ‹¬ λ‹«κΈ° μ‹ μ •μ‚° νμ΄μ§€λ΅ λ³µκ·€ μµμ…

### 7. μΌκ΄„ μ…κΈ/μ†΅κΈ μ²λ¦¬ κΈ°λ¥ κµ¬ν„
**ν„μ¬ μƒνƒ:**
- β… UI λ²„νΌ λ° μ²΄ν¬λ°•μ¤ κµ¬ν„
- β λ°±μ—”λ“ API λ―Έκµ¬ν„

**μ‘μ—… ν•„μ”:**
- [ ] `/api/hotel-settlements/bulk-payment` POST μ—”λ“ν¬μΈνΈ κµ¬ν„
- [ ] μ„ νƒλ μ •μ‚° ID λ°°μ—΄ μ²λ¦¬
- [ ] μ…κΈμΌ/μ†΅κΈμΌ μΌκ΄„ μ—…λ°μ΄νΈ
- [ ] μ†΅κΈ μ‹ ν™μ¨ μ μ© λ΅μ§

---

## πΆ μ¶”κ°€ κΈ°λ¥

### 8. μ •μ‚° ν†µκ³„ λ€μ‹λ³΄λ“
- [ ] λ―Έμ…κΈ κ±°λμ•΅ μ΄μ•΅ (μ—…μ²΄λ³„ λ¶„λ¥)
- [ ] λ―Έμ†΅κΈ λ§¤μ…μ•΅ μ΄μ•΅ (νΈν…”λ³„ λ¶„λ¥)
- [ ] μ›”κ°„ λ§μ§„ μ΄μ•΅
- [ ] μ›”κ°„ κ±°λμ•΅/λ§¤μ…μ•΅ μ¶”μ΄ κ·Έλν”„

### 9. μ •μ‚° ν•„ν„° λ° κ²€μƒ‰
- [ ] λ‚ μ§ λ²”μ„ ν•„ν„° (μ΄μ©μΌ, μ…κΈμΌ, μ†΅κΈμΌ)
- [ ] νΈν…”λ… κ²€μƒ‰
- [ ] μμ•½μ—…μ²΄ ν•„ν„°
- [ ] μ •μ‚° μƒνƒ ν•„ν„° (λ―Έμ…κΈ, λ―Έμ†΅κΈ, μ™„λ£)

### 10. μ •μ‚°μ„ μ¶λ ¥ κΈ°λ¥
- [ ] μ •μ‚° μƒμ„Έ μ •λ³΄ PDF μ¶λ ¥
- [ ] μ›”κ°„ μ •μ‚° λ¦¬ν¬νΈ μƒμ„±
- [ ] μ—‘μ…€ λ‹¤μ΄λ΅λ“ κΈ°λ¥

---

## π”§ κΈ°μ  λ¶€μ±„

### 11. μ½”λ“ λ¦¬ν©ν† λ§
- [ ] μ¤‘λ³µ μ½”λ“ μ κ±° (settlements.ejs vs hotel-settlements.ejs)
- [ ] κ³µν†µ ν•¨μ λ¨λ“ν™” (formatCurrency, formatDate λ“±)
- [ ] API μ‘λ‹µ λ°μ΄ν„° κµ¬μ΅° ν‘μ¤€ν™”

### 12. μ—λ¬ ν•Έλ“¤λ§ κ°μ„ 
- [ ] API νΈμ¶ μ‹¤ν¨ μ‹ μ‚¬μ©μ μΉν™”μ  λ©”μ‹μ§€
- [ ] λ„¤νΈμ›ν¬ μ¤λ¥ μ¬μ‹λ„ λ΅μ§
- [ ] λ΅λ”© μƒνƒ ν‘μ‹ κ°μ„ 

### 13. μ„±λ¥ μµμ ν™”
- [ ] μ •μ‚° λ©λ΅ νμ΄μ§€λ„¤μ΄μ…
- [ ] λ¬΄ν• μ¤ν¬λ΅¤ λλ” κ°€μƒ μ¤ν¬λ΅¤ μ μ©
- [ ] API μ‘λ‹µ μΊμ‹±

---

## π“ λ‚΄μΌ μ‘μ—… μμ„ (μ°μ„ μμ„)

### 1λ‹¨κ³„: λ°μ΄ν„° μ΅°ν μ¤λ¥ μμ • (μµμ°μ„ )
1. λΈλΌμ°μ € μ½μ†”μ—μ„ `/api/hotel-settlements` μ‘λ‹µ λ°μ΄ν„° ν™•μΈ
2. λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ‹¤μ  μ €μ¥λ κ°’ ν™•μΈ
3. ν”„λ΅ νΈμ—”λ“ λ§¤ν•‘ μμ •
4. ν…μ¤νΈ λ° κ²€μ¦

### 2λ‹¨κ³„: μ•„μ›ƒνΈν…” λ§¤μ…μ•΅ ν•„λ“ μ¶”κ°€
1. DB λ§μ΄κ·Έλ μ΄μ… μ¤ν¬λ¦½νΈ μ‘μ„±
2. λ°”μ°μ² μƒμ„± λ΅μ§μ— μ•„μ›ƒνΈν…” λΉ„μ© μ €μ¥
3. API μμ •
4. ν”„λ΅ νΈμ—”λ“ ν‘μ‹

### 3λ‹¨κ³„: μΌκ΄„ μ²λ¦¬ API κµ¬ν„
1. `/api/hotel-settlements/bulk-payment` μ—”λ“ν¬μΈνΈ μ‘μ„±
2. ν”„λ΅ νΈμ—”λ“ μ—°λ™
3. ν…μ¤νΈ

### 4λ‹¨κ³„: λ§μ§„ κ³„μ‚° λ΅μ§ κ²€μ¦
1. λ°±μ—”λ“ κ³„μ‚° λ΅μ§ ν™•μΈ
2. ν”„λ΅ νΈμ—”λ“ κ³„μ‚° λ΅μ§ ν™•μΈ
3. λ¶μΌμΉ μμ •

---

## π› μ•λ ¤μ§„ λ²„κ·Έ

1. **μ •μ‚° λ¦¬μ¤νΈ κΈμ•΅ ν‘μ‹ μ¤λ¥**
   - μ¦μƒ: κΈμ•΅μ΄ 0 λλ” NaNμΌλ΅ ν‘μ‹λ¨
   - μ›μΈ: λ°μ΄ν„° λ§¤ν•‘ μ¤λ¥
   - μƒνƒ: π”΄ λ―Έν•΄κ²°

2. **λ§μ§„ κ³„μ‚° μ¤λ¥**
   - μ¦μƒ: λ°±μ—”λ“μ™€ ν”„λ΅ νΈμ—”λ“ κ³„μ‚° κ²°κ³Ό λ¶μΌμΉ
   - μ›μΈ: μλ°°ν”Ό μ²λ¦¬ λ΅μ§ μ°¨μ΄
   - μƒνƒ: π”΄ λ―Έν•΄κ²°

3. **ν™μ¨ ν‘μ‹ μ¤λ¥**
   - μ¦μƒ: μΌλ¶€ ν•­λ©μ—μ„ ν™μ¨μ΄ ν‘μ‹λμ§€ μ•μ
   - μ›μΈ: exchange_rate ν•„λ“ null μ²λ¦¬ λ―Έν΅
   - μƒνƒ: π΅ λ¶€λ¶„ ν•΄κ²° (κΈ°λ³Έκ°’ 1300 μ μ©)

---

## π“ μ°Έκ³  μ‚¬ν•­

### API μ—”λ“ν¬μΈνΈ
- `GET /api/hotel-settlements` - μ •μ‚° λ©λ΅ μ΅°ν
- `GET /api/hotel-settlements/:id` - μ •μ‚° μƒμ„Έ μ΅°ν
- `PUT /api/hotel-settlements/:id` - μ •μ‚° μμ •
- `DELETE /api/hotel-settlements/:id` - μ •μ‚° μ‚­μ 
- `POST /api/hotel-settlements/bulk-payment` - μΌκ΄„ μ…κΈ/μ†΅κΈ (λ―Έκµ¬ν„)

### λ°μ΄ν„°λ² μ΄μ¤ ν…μ΄λΈ”
- `hotel_reservations` - μμ•½ λ° μ •μ‚° μ •λ³΄
- `hotels` - νΈν…” μ •λ³΄
- `booking_agencies` - μμ•½μ—…μ²΄ μ •λ³΄
- `exchange_rates` - ν™μ¨ μ •λ³΄

### κ΄€λ ¨ νμΌ
- `routes/hotel-settlements.js` - λ°±μ—”λ“ API
- `views/admin/hotel-settlements.ejs` - μ •μ‚°κ΄€λ¦¬ νμ΄μ§€
- `views/admin/hotel-assignments.ejs` - μλ°°κ΄€λ¦¬ νμ΄μ§€

---

## β… μ™„λ£λ μ‘μ—… (μ¤λ)

1. β… νΈν…” μ •μ‚° ν…μ΄λΈ” ν•μ‹ κµ¬ν„
2. β… λ‹¬λ¬ & μ›ν™” λ™μ‹ ν‘μ‹
3. β… μλ°°ν”Ό, λ§μ§„, λ¶€κ°€μ„Έ μ»¬λΌ μ¶”κ°€
4. β… ν™μ¨ μ»¬λΌ μ¶”κ°€
5. β… μΌκ΄„ μ…κΈ/μ†΅κΈ UI κµ¬ν„
6. β… μ •μ‚° μ΄κ΄€ κΈ°λ¥ κ°μ„  (μ¤λ ν™μ¨ μλ™ μ΅°ν)
7. β… μ •μ‚° λ¦¬μ¤νΈ ν΄λ¦­ μ‹ μλ°°κ΄€λ¦¬ λ¨λ‹¬ μ—°λ™

---

**μ‘μ„±μ:** Cascade AI
**μµμΆ… μμ •:** 2025-11-27 17:51
