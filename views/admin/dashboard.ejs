<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* ì¹´ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        /* ê¸´ê¸‰ ì•¡ì…˜ */
        .urgent-item {
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .urgent-item:hover {
            background: #f8f9fa;
        }
        
        .urgent-item.danger {
            border-left: 4px solid #dc3545;
            background: #fff5f5;
        }
        
        .urgent-item.warning {
            border-left: 4px solid #ffc107;
            background: #fffbf0;
        }
        
        .urgent-item.info {
            border-left: 4px solid #17a2b8;
            background: #f0f9ff;
        }
        
        /* ì›Œí¬í”Œë¡œìš° */
        .workflow-item {
            text-align: center;
            padding: 1rem;
            border-radius: 6px;
            background: #f8f9fa;
        }
        
        .workflow-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 1.5rem;
        }
        
        /* ì˜¤ëŠ˜ì˜ ìˆ«ì */
        .today-stat {
            text-align: center;
            padding: 1.5rem;
            border-radius: 6px;
            border: 2px solid #e9ecef;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        /* ì•Œë¦¼ ì•„ì´í…œ */
        .alert-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .alert-item:last-child {
            border-bottom: none;
        }
        
        .alert-item:hover {
            background: #f8f9fa;
            cursor: pointer;
        }
        
        /* ìº˜ë¦°ë” */
        .calendar-day {
            text-align: center;
            padding: 0.75rem;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calendar-day:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }
        
        .calendar-day.today {
            background: #e7f3ff;
            border-color: #007bff;
            font-weight: 600;
        }
        
        .day-name {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }
        
        .day-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        /* ì •ì‚° ìš”ì•½ */
        .settlement-box {
            padding: 1rem;
            border-radius: 6px;
            border: 2px solid #e9ecef;
            text-align: center;
        }
        
        .settlement-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #dc3545;
        }
    </style>
</head>
<body>
    <%- include('../partials/navbar', { currentPage: 'dashboard', adminUsername: adminUsername }) %>

    <div class="container mt-4 mb-5">
        <h2><i class="fas fa-tachometer-alt me-2"></i><%= title %></h2>
        <p class="text-muted">í™˜ì˜í•©ë‹ˆë‹¤, <%= adminUsername %>ë‹˜</p>

        <!-- Phase 1: ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼ -->
        <div class="dashboard-card">
            <h5 class="card-title">âš ï¸ ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼</h5>
            
            <% if (urgentActions.todayDeparture > 0) { %>
            <div class="urgent-item danger" onclick="location.href='/admin/reservations'">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>ğŸ”´ ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš”</strong>
                        <p class="mb-0 small">ì˜¤ëŠ˜ ì¶œë°œí•˜ëŠ”ë° ìˆ˜ë°° ë¯¸ì™„ë£Œ ì˜ˆì•½</p>
                    </div>
                    <h3 class="mb-0"><%= urgentActions.todayDeparture %>ê±´</h3>
                </div>
            </div>
            <% } %>
            
            <% if (urgentActions.pendingOver24h > 0) { %>
            <div class="urgent-item warning" onclick="location.href='/admin/reservations?status=pending'">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>ğŸŸ¡ ì˜¤ëŠ˜ ì²˜ë¦¬ ê¶Œì¥</strong>
                        <p class="mb-0 small">ëŒ€ê¸°ì¤‘ 24ì‹œê°„ ê²½ê³¼</p>
                    </div>
                    <h3 class="mb-0"><%= urgentActions.pendingOver24h %>ê±´</h3>
                </div>
            </div>
            <% } %>
            
            <% if (urgentActions.tomorrowDepartures > 0) { %>
            <div class="urgent-item info" onclick="location.href='/admin/reservations'">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>ğŸ”µ ì˜ˆì •ëœ ì‘ì—…</strong>
                        <p class="mb-0 small">ë‚´ì¼ ì¶œë°œ ì˜ˆì•½ í™•ì¸ í•„ìš”</p>
                    </div>
                    <h3 class="mb-0"><%= urgentActions.tomorrowDepartures %>ê±´</h3>
                </div>
            </div>
            <% } %>
            
            <% if (urgentActions.todayDeparture === 0 && urgentActions.pendingOver24h === 0) { %>
            <div class="text-center text-muted py-4">
                <i class="fas fa-check-circle fa-3x mb-3" style="color: #28a745;"></i>
                <p>ëª¨ë“  ê¸´ê¸‰ ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‘</p>
            </div>
            <% } %>
        </div>
        
        <!-- Phase 1: ì›Œí¬í”Œë¡œìš° í˜„í™© & ì˜¤ëŠ˜ì˜ ìˆ«ì -->
        <div class="row">
            <div class="col-md-7">
                <div class="dashboard-card">
                    <h5 class="card-title">ğŸ“Š ì›Œí¬í”Œë¡œìš° í˜„í™©</h5>
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="workflow-item">
                                <div class="text-muted small mb-1">ëŒ€ê¸°ì¤‘</div>
                                <h4 class="mb-0"><%= workflow.pending %></h4>
                            </div>
                        </div>
                        <div class="col-auto workflow-arrow">â†’</div>
                        <div class="col">
                            <div class="workflow-item">
                                <div class="text-muted small mb-1">ìˆ˜ë°°ì¤‘</div>
                                <h4 class="mb-0"><%= workflow.in_progress %></h4>
                            </div>
                        </div>
                        <div class="col-auto workflow-arrow">â†’</div>
                        <div class="col">
                            <div class="workflow-item">
                                <div class="text-muted small mb-1">í™•ì •</div>
                                <h4 class="mb-0"><%= workflow.confirmed %></h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-5">
                <div class="dashboard-card">
                    <h5 class="card-title">ğŸ“ˆ ì˜¤ëŠ˜ì˜ ìˆ«ì</h5>
                    <div class="row g-2">
                        <div class="col-4">
                            <div class="today-stat">
                                <div class="stat-value text-primary"><%= todayStats.newReservations %></div>
                                <div class="stat-label">ì‹ ê·œì˜ˆì•½</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="today-stat">
                                <div class="stat-value text-success"><%= todayStats.completed %></div>
                                <div class="stat-label">ì²˜ë¦¬ì™„ë£Œ</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="today-stat">
                                <div class="stat-value text-warning">$<%= Math.round(todayStats.revenue) %></div>
                                <div class="stat-label">ë§¤ì¶œì•¡</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 2: ì•Œë¦¼ ì„¼í„° & ìº˜ë¦°ë” -->
        <div class="row">
            <div class="col-md-6">
                <div class="dashboard-card">
                    <h5 class="card-title">ğŸ”” ì•Œë¦¼ ì„¼í„°</h5>
                    <% if (dataIssues && dataIssues.length > 0) { %>
                        <% dataIssues.forEach(issue => { %>
                        <div class="alert-item" onclick="location.href='/admin/reservations'">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            <div class="flex-grow-1">
                                <strong><%= issue.issue_type %></strong>
                                <p class="mb-0 small text-muted">
                                    <%= issue.reservation_number %> - <%= issue.korean_name || 'ì˜ˆì•½ì' %>
                                </p>
                            </div>
                            <i class="fas fa-chevron-right text-muted"></i>
                        </div>
                        <% }); %>
                    <% } else { %>
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-check-circle fa-2x mb-2" style="color: #28a745;"></i>
                            <p>ëª¨ë“  ë°ì´í„°ê°€ ì •ìƒì…ë‹ˆë‹¤!</p>
                        </div>
                    <% } %>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="dashboard-card">
                    <h5 class="card-title">ğŸ“… ì´ë²ˆì£¼ ì¼ì •</h5>
                    <div class="row g-2">
                        <% 
                        const daysOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                        const today = new Date().toISOString().split('T')[0];
                        
                        for (let i = 0; i < 7; i++) {
                            const date = new Date(Date.now() + i * 86400000);
                            const dateStr = date.toISOString().split('T')[0];
                            const dayOfWeek = daysOfWeek[date.getDay()];
                            const calendarItem = weeklyCalendar.find(item => item.usage_date === dateStr);
                            const count = calendarItem ? calendarItem.count : 0;
                            const isToday = dateStr === today;
                        %>
                        <div class="col">
                            <div class="calendar-day <%= isToday ? 'today' : '' %>" onclick="location.href='/admin/reservations?date=<%= dateStr %>'">
                                <div class="day-name"><%= dayOfWeek %></div>
                                <div class="day-count"><%= count %></div>
                            </div>
                        </div>
                        <% } %>
                    </div>
                </div>
                
                <div class="dashboard-card mt-3">
                    <h5 class="card-title">ğŸ’° ì •ì‚° ìš”ì•½</h5>
                    <div class="row">
                        <div class="col-6">
                            <div class="settlement-box">
                                <div class="text-muted small">í™•ì • ì˜ˆì•½</div>
                                <div class="settlement-amount"><%= settlements.unpaidCount %>ê±´</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="settlement-box">
                                <div class="text-muted small">ì´ ì˜ˆìƒ ë§¤ì¶œ</div>
                                <div class="settlement-amount">$<%= Math.round(settlements.unpaidAmount) %></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <footer style="text-align: center; padding: 20px 0; font-size: 14px; color: #333; background: #f8f9fa; margin-top: 30px; border-top: 1px solid #dee2e6; font-weight: 500;">
        &copy; 2025 luxfind. All rights reserved.
    </footer>
</body>
</html>
