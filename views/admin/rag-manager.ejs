<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG ìƒí’ˆ ê°€ì´ë“œ ê´€ë¦¬ | ê´Œì„¸ì´ë¸Œì¹´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        .main-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .guide-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .guide-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .category-badge {
            font-size: 0.85rem;
            padding: 5px 12px;
            border-radius: 20px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5568d3 0%, #6a3f8f 100%);
        }
        
        .code-editor {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
        }
        
        .alert-custom {
            border-left: 4px solid #667eea;
            background: #f0f4ff;
        }
    </style>
</head>
<body>
    <%- include('../partials/navbar', { currentPage: 'rag-manager', adminUsername: adminUsername || 'admin' }) %>

    <div class="main-container">
        <!-- í˜ì´ì§€ í—¤ë” -->
        <div class="page-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h2 class="mb-2">
                        <i class="bi bi-book-half text-primary me-2"></i>RAG ìƒí’ˆ ê°€ì´ë“œ ê´€ë¦¬
                    </h2>
                    <p class="text-muted mb-0">ë°”ìš°ì²˜ì— ìë™ìœ¼ë¡œ í¬í•¨ë  ìƒí’ˆë³„ ì´ìš©ë°©ë²•ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-primary btn-lg" onclick="openCreateModal()">
                        <i class="bi bi-plus-circle me-2"></i>ìƒˆ ê°€ì´ë“œ ë“±ë¡
                    </button>
                </div>
            </div>
        </div>

        <!-- í†µê³„ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <h3 class="mb-2" id="total-guides">0</h3>
                    <p class="mb-0"><i class="bi bi-file-text me-2"></i>ì „ì²´ ê°€ì´ë“œ</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h3 class="text-primary mb-2" id="category-count">0</h3>
                        <p class="text-muted mb-0"><i class="bi bi-tags me-2"></i>ì¹´í…Œê³ ë¦¬ ìˆ˜</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h3 class="text-success mb-2" id="recent-updates">0</h3>
                        <p class="text-muted mb-0"><i class="bi bi-clock-history me-2"></i>ìµœê·¼ ìˆ˜ì •</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <button class="btn btn-outline-primary w-100" onclick="refreshGuides()">
                            <i class="bi bi-arrow-clockwise me-2"></i>ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê²€ìƒ‰ ë° í•„í„° -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="search-input" 
                               placeholder="ìƒí’ˆëª… ë˜ëŠ” í‚¤ì›Œë“œ ê²€ìƒ‰..." 
                               onkeyup="filterGuides()">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="category-filter" onchange="filterGuides()">
                            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-secondary w-100" onclick="resetFilters()">
                            <i class="bi bi-x-circle me-2"></i>í•„í„° ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì•ˆë‚´ -->
        <div class="alert alert-custom">
            <i class="bi bi-info-circle me-2"></i>
            <strong>ğŸ’¡ ê°€ì´ë“œ ì‘ì„± ë°©ë²•:</strong> 
            <ol class="mb-0 mt-2">
                <li><strong>ììœ  í˜•ì‹ ì‘ì„±:</strong> <code>=== ì›í•˜ëŠ” ì„¹ì…˜ëª… ===</code> í˜•ì‹ìœ¼ë¡œ ì›í•˜ëŠ” ë§Œí¼ ì„¹ì…˜ì„ ì¶”ê°€í•˜ì„¸ìš”.</li>
                <li><strong>í•„ìˆ˜ ì„¹ì…˜:</strong> <code>=== ì´ìš© ë°©ë²• ===</code> ì„¹ì…˜ì€ ë°”ìš°ì²˜ì— ìë™ìœ¼ë¡œ í¬í•¨ë˜ë‹ˆ ê¼­ ì‘ì„±í•˜ì„¸ìš”.</li>
                <li><strong>ì¶”ì²œ ì„¹ì…˜:</strong> ìœ„ì¹˜ì •ë³´, ìš´ì˜ì‹œê°„, ì£¼ì˜ì‚¬í•­, ì¤€ë¹„ë¬¼, ì·¨ì†Œê·œì • ë“± í•„ìš”í•œ ì„¹ì…˜ì„ ììœ ë¡­ê²Œ ì¶”ê°€í•˜ì„¸ìš”.</li>
                <li><strong>í…œí”Œë¦¿:</strong> ì²˜ìŒ ì‘ì„±ì´ ì–´ë µë‹¤ë©´ "ê¸°ë³¸ í…œí”Œë¦¿" ë²„íŠ¼ìœ¼ë¡œ ê¸°ë³¸ êµ¬ì¡°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ol>
        </div>

        <!-- ê°€ì´ë“œ ëª©ë¡ -->
        <div id="guides-container" class="row">
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">ë¡œë”©ì¤‘...</span>
                </div>
                <p class="text-muted mt-3">ê°€ì´ë“œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>
    </div>

    <!-- ìƒì„±/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal fade" id="guideModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-file-earmark-text me-2"></i>
                        <span id="modal-title">ìƒˆ ê°€ì´ë“œ ë“±ë¡</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                    <ul class="nav nav-tabs mb-4" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#basic-tab" type="button">
                                <i class="bi bi-info-circle me-2"></i>ê¸°ë³¸ ì •ë³´
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#content-tab" type="button">
                                <i class="bi bi-file-text me-2"></i>ê°€ì´ë“œ ë‚´ìš©
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#preview-tab" type="button">
                                <i class="bi bi-eye me-2"></i>ë¯¸ë¦¬ë³´ê¸°
                            </button>
                        </li>
                    </ul>

                    <!-- íƒ­ ì»¨í…ì¸  -->
                    <div class="tab-content">
                        <!-- ê¸°ë³¸ ì •ë³´ íƒ­ -->
                        <div class="tab-pane fade show active" id="basic-tab">
                            <div class="row mb-3">
                                <div class="col-md-8">
                                    <label class="form-label fw-bold">ìƒí’ˆëª… <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control form-control-lg" id="product-name" 
                                           placeholder="ì˜ˆ: ì–¸ë”ì›Œí„°ì›”ë“œ ì…ì¥ê¶Œ">
                                    <small class="text-muted">ë°”ìš°ì²˜ ìƒì„± ì‹œ ì´ ì´ë¦„ìœ¼ë¡œ ìë™ ë§¤ì¹­ë©ë‹ˆë‹¤</small>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-bold">ì¹´í…Œê³ ë¦¬ <span class="text-danger">*</span></label>
                                    <select class="form-select form-select-lg" id="category">
                                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                        <option value="ê´€ê´‘/ì²´í—˜">ê´€ê´‘/ì²´í—˜</option>
                                        <option value="ì•¡í‹°ë¹„í‹°">ì•¡í‹°ë¹„í‹°</option>
                                        <option value="ë ˆìŠ¤í† ë‘">ë ˆìŠ¤í† ë‘</option>
                                        <option value="ë Œí„°ì¹´">ë Œí„°ì¹´</option>
                                        <option value="ìŠ¤íŒŒ/ë§ˆì‚¬ì§€">ìŠ¤íŒŒ/ë§ˆì‚¬ì§€</option>
                                        <option value="ì‡¼/ê³µì—°">ì‡¼/ê³µì—°</option>
                                        <option value="íˆ¬ì–´">íˆ¬ì–´</option>
                                        <option value="ì›Œí„°íŒŒí¬">ì›Œí„°íŒŒí¬</option>
                                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">ê²€ìƒ‰ í‚¤ì›Œë“œ</label>
                                <input type="text" class="form-control" id="keywords" 
                                       placeholder="ìˆ˜ì¡±ê´€, í•´ì–‘ìƒë¬¼, ê°€ì¡±ì—¬í–‰ (ì‰¼í‘œë¡œ êµ¬ë¶„)">
                                <small class="text-muted">AIê°€ ìƒí’ˆì„ ë” ì •í™•í•˜ê²Œ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ê´€ë ¨ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">ìƒí’ˆ ì„¤ëª…</label>
                                <textarea class="form-control" id="description" rows="3" 
                                          placeholder="ìƒí’ˆì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>
                        </div>

                        <!-- ê°€ì´ë“œ ë‚´ìš© íƒ­ -->
                        <div class="tab-pane fade" id="content-tab">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>=== ì„¹ì…˜ëª… ===</strong> í˜•ì‹ìœ¼ë¡œ ììœ ë¡­ê²Œ ì„¹ì…˜ì„ ì¶”ê°€í•˜ì„¸ìš”. <strong>=== ì´ìš© ë°©ë²• ===</strong> ì„¹ì…˜ì€ ë°”ìš°ì²˜ì— ìë™ í¬í•¨ë©ë‹ˆë‹¤.
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">ê°€ì´ë“œ ë‚´ìš© <span class="text-danger">*</span></label>
                                <textarea class="form-control code-editor" id="guide-content" rows="25" 
placeholder="=== ì´ìš© ë°©ë²• ===

1. ì˜ˆì•½ í™•ì¸
   - ë°”ìš°ì²˜ ì§€ì°¸
   - ì»¨íŒë²ˆí˜¸ í™•ì¸

2. í˜„ì¥ ë„ì°©
   - ì˜ˆì•½ ì‹œê°„ 10ë¶„ ì „ ë„ì°© ê¶Œì¥

3. ì´ìš© ì ˆì°¨
   - ë§¤í‘œì†Œì—ì„œ ë°”ìš°ì²˜ ì œì‹œ
   - ì…ì¥ê¶Œ êµí™˜ í›„ ì´ìš©

=== ìœ„ì¹˜ ë° ì—°ë½ì²˜ ===

ì£¼ì†Œ: 
ìš´ì˜ì‹œê°„: 
ì—°ë½ì²˜: 

=== ì£¼ì˜ì‚¬í•­ ===

- 
- 

=== ì·¨ì†Œ ë° í™˜ë¶ˆ ===

- ì´ìš©ì¼ ê¸°ì¤€ 

=== ì¤€ë¹„ë¬¼ ===

- 
- 

ğŸ’¡ íŒ: === ì›í•˜ëŠ”ì„¹ì…˜ëª… === ìœ¼ë¡œ ì„¹ì…˜ì„ ììœ ë¡­ê²Œ ì¶”ê°€í•˜ì„¸ìš”!"></textarea>
                                <div class="form-text">
                                    <i class="bi bi-star-fill text-warning me-1"></i>
                                    <strong>=== ì´ìš© ë°©ë²• ===</strong> ì„¹ì…˜ì€ ë°˜ë“œì‹œ í¬í•¨í•´ì£¼ì„¸ìš” (ë°”ìš°ì²˜ì— ìë™ í‘œì‹œë¨)
                                </div>
                            </div>
                        </div>

                        <!-- ë¯¸ë¦¬ë³´ê¸° íƒ­ -->
                        <div class="tab-pane fade" id="preview-tab">
                            <div class="alert alert-warning">
                                <i class="bi bi-eye me-2"></i>
                                ì•„ë˜ëŠ” ìµœì¢… ìƒì„±ë  ê°€ì´ë“œ ë‚´ìš©ì…ë‹ˆë‹¤. ì €ì¥ ì „ í™•ì¸í•´ì£¼ì„¸ìš”.
                            </div>
                            <pre class="code-editor border rounded p-3 bg-light" id="final-preview" style="max-height: 600px; overflow-y: auto;"></pre>
                            <button class="btn btn-outline-secondary" onclick="updatePreview()">
                                <i class="bi bi-arrow-clockwise me-1"></i>ë¯¸ë¦¬ë³´ê¸° ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline-secondary" onclick="generateTemplate()">
                        <i class="bi bi-file-earmark-code me-1"></i>ê¸°ë³¸ í…œí”Œë¦¿
                    </button>
                    <button class="btn btn-outline-info" onclick="addSection()">
                        <i class="bi bi-plus-circle me-1"></i>ì„¹ì…˜ ì¶”ê°€ ë„ìš°ë¯¸
                    </button>
                    <button class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button class="btn btn-primary" onclick="saveGuide()">
                        <i class="bi bi-check-circle me-1"></i>ì €ì¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-eye me-2"></i>ê°€ì´ë“œ ë¯¸ë¦¬ë³´ê¸°
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <pre class="code-editor border rounded p-3 bg-light" id="preview-content"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let guides = [];
        let currentEditingId = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê°€ì´ë“œ ëª©ë¡ ì¡°íšŒ
        document.addEventListener('DOMContentLoaded', () => {
            loadGuides();
            
            // ë¯¸ë¦¬ë³´ê¸° íƒ­ í´ë¦­ ì‹œ ìë™ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            document.querySelector('[data-bs-target="#preview-tab"]').addEventListener('click', () => {
                setTimeout(updatePreview, 100);
            });
        });

        // ê°€ì´ë“œ ëª©ë¡ ë¡œë“œ
        async function loadGuides() {
            try {
                const response = await fetch('/api/rag/guides');
                const data = await response.json();
                
                if (data.success) {
                    guides = data.guides;
                    renderGuides();
                    updateStats();
                    updateCategoryFilter();
                } else {
                    showAlert('ê°€ì´ë“œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ' + data.message, 'danger');
                }
            } catch (error) {
                console.error('ê°€ì´ë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
                showAlert('ê°€ì´ë“œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ê°€ì´ë“œ ë Œë”ë§
        function renderGuides() {
            const container = document.getElementById('guides-container');
            
            if (guides.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-inbox" style="font-size: 4rem; color: #ddd;"></i>
                        <p class="text-muted mt-3">ë“±ë¡ëœ ê°€ì´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <button class="btn btn-primary" onclick="openCreateModal()">
                            <i class="bi bi-plus-circle me-2"></i>ì²« ê°€ì´ë“œ ë“±ë¡í•˜ê¸°
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = guides.map(guide => `
                <div class="col-md-6 col-lg-4 guide-item" 
                     data-name="${guide.name}" 
                     data-category="${guide.category}">
                    <div class="card guide-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">${guide.name}</h5>
                                <span class="category-badge badge bg-primary">${guide.category}</span>
                            </div>
                            <p class="text-muted small mb-3">
                                <i class="bi bi-calendar me-1"></i>${new Date(guide.created_at).toLocaleDateString('ko-KR')}
                            </p>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary btn-sm flex-fill" 
                                        onclick="editGuide(${guide.id})">
                                    <i class="bi bi-pencil"></i> ìˆ˜ì •
                                </button>
                                <button class="btn btn-outline-info btn-sm flex-fill" 
                                        onclick="previewGuide(${guide.id})">
                                    <i class="bi bi-eye"></i> ë³´ê¸°
                                </button>
                                <button class="btn btn-outline-danger btn-sm" 
                                        onclick="deleteGuide(${guide.id}, '${guide.name}')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('total-guides').textContent = guides.length;
            
            const categories = new Set(guides.map(g => g.category));
            document.getElementById('category-count').textContent = categories.size;
            
            // ìµœê·¼ ìˆ˜ì • (ì„ì‹œ)
            document.getElementById('recent-updates').textContent = guides.length;
        }

        // ì¹´í…Œê³ ë¦¬ í•„í„° ì—…ë°ì´íŠ¸
        function updateCategoryFilter() {
            const categories = [...new Set(guides.map(g => g.category))];
            const select = document.getElementById('category-filter');
            
            select.innerHTML = '<option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>' +
                categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        // í•„í„°ë§
        function filterGuides() {
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const category = document.getElementById('category-filter').value;
            
            document.querySelectorAll('.guide-item').forEach(item => {
                const name = item.dataset.name.toLowerCase();
                const itemCategory = item.dataset.category;
                
                const matchSearch = name.includes(searchText);
                const matchCategory = !category || itemCategory === category;
                
                item.style.display = matchSearch && matchCategory ? '' : 'none';
            });
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('category-filter').value = '';
            filterGuides();
        }

        // ìƒˆë¡œê³ ì¹¨
        function refreshGuides() {
            loadGuides();
            showAlert('âœ… ëª©ë¡ì´ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // ìƒì„± ëª¨ë‹¬ ì—´ê¸°
        function openCreateModal() {
            currentEditingId = null;
            document.getElementById('modal-title').textContent = 'ìƒˆ ê°€ì´ë“œ ë“±ë¡';
            
            // ê¸°ë³¸ ì •ë³´ ì´ˆê¸°í™”
            document.getElementById('product-name').value = '';
            document.getElementById('category').value = '';
            document.getElementById('keywords').value = '';
            document.getElementById('description').value = '';
            
            // ê°€ì´ë“œ ë‚´ìš© ì´ˆê¸°í™”
            document.getElementById('guide-content').value = '';
            
            new bootstrap.Modal(document.getElementById('guideModal')).show();
        }
        
        // í¼ ë°ì´í„°ë¥¼ ê°€ì´ë“œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        function generateGuideText() {
            const productName = document.getElementById('product-name').value.trim();
            const category = document.getElementById('category').value.trim();
            const keywords = document.getElementById('keywords').value.trim();
            const description = document.getElementById('description').value.trim();
            const guideContent = document.getElementById('guide-content').value.trim();
            
            let guideText = `ìƒí’ˆëª…: ${productName}\n`;
            guideText += `ì¹´í…Œê³ ë¦¬: ${category || 'ë¯¸ë¶„ë¥˜'}\n`;
            if (keywords) guideText += `í‚¤ì›Œë“œ: ${keywords}\n`;
            if (description) guideText += `\nì„¤ëª…: ${description}\n`;
            
            if (guideContent) {
                guideText += `\n${guideContent}`;
            }
            
            return guideText;
        }
        
        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const guideText = generateGuideText();
            document.getElementById('final-preview').textContent = guideText;
        }
        
        // í…œí”Œë¦¿ ìƒì„± (ê¸°ë³¸ê°’ ì±„ìš°ê¸°)
        function generateTemplate() {
            const productName = document.getElementById('product-name').value;
            
            // ê¸°ë³¸ í…œí”Œë¦¿ ê°’ ì„¤ì •
            if (!document.getElementById('keywords').value) {
                document.getElementById('keywords').value = 'ê´€ê´‘, ì²´í—˜';
            }
            
            if (!document.getElementById('description').value && productName) {
                document.getElementById('description').value = `${productName} ì´ìš© ê°€ì´ë“œ`;
            }
            
            // ê°€ì´ë“œ ë‚´ìš© í…œí”Œë¦¿ - ê°„ë‹¨í•˜ê³  ììœ ë¡œìš´ í˜•ì‹
            const currentContent = document.getElementById('guide-content').value;
            if (!currentContent || currentContent.trim() === '') {
                document.getElementById('guide-content').value = `=== ì´ìš© ë°©ë²• ===\n\n1. ì˜ˆì•½ í™•ì¸\n   - ë°”ìš°ì²˜ ì§€ì°¸\n\n2. í˜„ì¥ ë„ì°©\n   - \n\n3. ì´ìš© ì ˆì°¨\n   - \n\n=== ìœ„ì¹˜ ì •ë³´ ===\n\nì£¼ì†Œ: \nìš´ì˜ì‹œê°„: \nì—°ë½ì²˜: \n\n=== ì£¼ì˜ì‚¬í•­ ===\n\n- \n\n=== ì·¨ì†Œ/í™˜ë¶ˆ ===\n\n- `;
            }
            
            // ê°€ì´ë“œ ë‚´ìš© íƒ­ìœ¼ë¡œ ì´ë™
            document.querySelector('[data-bs-target="#content-tab"]').click();
            
            showAlert('âœ… ê¸°ë³¸ í…œí”Œë¦¿ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
        
        // ì„¹ì…˜ ì¶”ê°€ ë„ìš°ë¯¸
        function addSection() {
            const sectionName = prompt('ì¶”ê°€í•  ì„¹ì…˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”\nì˜ˆ: ì¤€ë¹„ë¬¼, êµí†µí¸, í¬í•¨ì‚¬í•­, ë¶ˆí¬í•¨ì‚¬í•­ ë“±');
            
            if (!sectionName) return;
            
            const textarea = document.getElementById('guide-content');
            const currentValue = textarea.value;
            const newSection = `\n\n=== ${sectionName} ===\n\n- \n`;
            
            textarea.value = currentValue + newSection;
            textarea.focus();
            
            // ê°€ì´ë“œ ë‚´ìš© íƒ­ìœ¼ë¡œ ì´ë™
            document.querySelector('[data-bs-target="#content-tab"]').click();
            
            showAlert(`âœ… "${sectionName}" ì„¹ì…˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        // ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        async function editGuide(id) {
            try {
                const response = await fetch(`/api/rag/guides/${id}`);
                const data = await response.json();
                
                if (data.success) {
                    currentEditingId = id;
                    document.getElementById('modal-title').textContent = 'ê°€ì´ë“œ ìˆ˜ì •';
                    
                    // íŒŒì‹±
                    const content = data.content;
                    
                    // ê¸°ë³¸ ì •ë³´
                    const nameMatch = content.match(/ìƒí’ˆëª…:\s*(.+)/);
                    const categoryMatch = content.match(/ì¹´í…Œê³ ë¦¬:\s*(.+)/);
                    const keywordsMatch = content.match(/í‚¤ì›Œë“œ:\s*(.+)/);
                    const descMatch = content.match(/ì„¤ëª…:\s*(.+)/);
                    
                    document.getElementById('product-name').value = nameMatch ? nameMatch[1].trim() : '';
                    document.getElementById('category').value = categoryMatch ? categoryMatch[1].trim() : '';
                    document.getElementById('keywords').value = keywordsMatch ? keywordsMatch[1].trim() : '';
                    document.getElementById('description').value = descMatch ? descMatch[1].trim() : '';
                    
                    // ê°€ì´ë“œ ë‚´ìš© (ê¸°ë³¸ ì •ë³´ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ë¶€ë¶„)
                    // "ìƒí’ˆëª…:", "ì¹´í…Œê³ ë¦¬:", "í‚¤ì›Œë“œ:", "ì„¤ëª…:" ì´í›„ì˜ ë‚´ìš©ë§Œ ì¶”ì¶œ
                    let guideContent = content;
                    
                    // ë§¨ ìœ„ì˜ ë©”íƒ€ ì •ë³´ë“¤ì„ ì œê±°
                    guideContent = guideContent.replace(/^ìƒí’ˆëª…:.*\n/, '');
                    guideContent = guideContent.replace(/^ì¹´í…Œê³ ë¦¬:.*\n/, '');
                    guideContent = guideContent.replace(/^í‚¤ì›Œë“œ:.*\n/, '');
                    guideContent = guideContent.replace(/^\n*ì„¤ëª…:.*\n/, '');
                    guideContent = guideContent.trim();
                    
                    document.getElementById('guide-content').value = guideContent;
                    
                    new bootstrap.Modal(document.getElementById('guideModal')).show();
                }
            } catch (error) {
                console.error('ê°€ì´ë“œ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                showAlert('ê°€ì´ë“œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ë¯¸ë¦¬ë³´ê¸°
        async function previewGuide(id) {
            try {
                const response = await fetch(`/api/rag/guides/${id}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('preview-content').textContent = data.content;
                    new bootstrap.Modal(document.getElementById('previewModal')).show();
                }
            } catch (error) {
                showAlert('ê°€ì´ë“œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ì €ì¥
        async function saveGuide() {
            const productName = document.getElementById('product-name').value.trim();
            const category = document.getElementById('category').value.trim();
            const guideContent = document.getElementById('guide-content').value.trim();
            
            if (!productName) {
                showAlert('ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                // ê¸°ë³¸ ì •ë³´ íƒ­ìœ¼ë¡œ ì´ë™
                document.querySelector('[data-bs-target="#basic-tab"]').click();
                return;
            }
            
            if (!category) {
                showAlert('ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                document.querySelector('[data-bs-target="#basic-tab"]').click();
                return;
            }
            
            if (!guideContent) {
                showAlert('ê°€ì´ë“œ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                document.querySelector('[data-bs-target="#content-tab"]').click();
                return;
            }
            
            // í¼ ë°ì´í„°ë¥¼ ê°€ì´ë“œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
            const content = generateGuideText();
            
            try {
                const response = await fetch('/api/rag/guides', {
                    method: currentEditingId ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: currentEditingId,
                        productName,
                        content
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('âœ… ê°€ì´ë“œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('guideModal')).hide();
                    loadGuides();
                } else {
                    showAlert('ì €ì¥ ì‹¤íŒ¨: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ì‚­ì œ
        async function deleteGuide(id, productName) {
            if (!confirm(`"${productName}" ê°€ì´ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/rag/guides/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('âœ… ê°€ì´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadGuides();
                } else {
                    showAlert('ì‚­ì œ ì‹¤íŒ¨: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ì•Œë¦¼
        function showAlert(message, type) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3" 
                     style="z-index: 9999; min-width: 300px;" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', alertHtml);
            
            setTimeout(() => {
                document.querySelector('.alert')?.remove();
            }, 3000);
        }
    </script>
</body>
</html>
