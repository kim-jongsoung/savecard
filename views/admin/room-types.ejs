<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê°ì‹¤ íƒ€ì… ê´€ë¦¬ - ê´Œ ì„¸ì´ë¸Œì¹´ë“œ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    /* ì „ì²´ í°íŠ¸ í¬ê¸° 30% ì¶•ì†Œ */
    body {
      font-size: 0.7rem;
    }
    h2 {
      font-size: 1.4rem;
    }
    h5 {
      font-size: 1rem;
    }
    h6 {
      font-size: 0.85rem;
    }
    .btn {
      font-size: 0.7rem;
      padding: 0.3rem 0.7rem;
    }
    .form-label {
      font-size: 0.7rem;
      margin-bottom: 0.3rem;
    }
    .form-control, .form-select {
      font-size: 0.7rem;
      padding: 0.3rem 0.5rem;
    }
    .modal-title {
      font-size: 1.1rem;
    }
    .table {
      font-size: 0.7rem;
    }
    .table th {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.5rem;
    }
    .table td {
      padding: 0.5rem;
    }
    .badge {
      font-size: 0.65rem;
      padding: 0.25rem 0.5rem;
    }
    .filter-card {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <%- include('../partials/navbar') %>
  
  <div class="container-fluid mt-4">
    <div class="row">
      <div class="col-12">
        <!-- í—¤ë” -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2><i class="bi bi-door-open"></i> ê°ì‹¤ íƒ€ì… ê´€ë¦¬</h2>
          <button class="btn btn-primary" onclick="openAddModal()">
            <i class="bi bi-plus-circle"></i> ê°ì‹¤ íƒ€ì… ë“±ë¡
          </button>
        </div>
        
        <!-- í•„í„° -->
        <div class="filter-card">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">í˜¸í…” ì„ íƒ</label>
              <select class="form-select" id="filterHotel" onchange="loadRoomTypes();">
                <option value="">ì „ì²´ í˜¸í…”</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">ê²€ìƒ‰</label>
              <input type="text" class="form-control" id="filterSearch" placeholder="ê°ì‹¤ íƒ€ì…ëª… ë˜ëŠ” ì½”ë“œ" onkeyup="if(event.key==='Enter') loadRoomTypes();">
            </div>
            <div class="col-md-2">
              <label class="form-label">ìƒíƒœ</label>
              <select class="form-select" id="filterActive" onchange="loadRoomTypes();">
                <option value="">ì „ì²´</option>
                <option value="true" selected>í™œì„±</option>
                <option value="false">ë¹„í™œì„±</option>
              </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
              <button class="btn btn-secondary me-2" onclick="loadRoomTypes();">
                <i class="bi bi-search"></i> ê²€ìƒ‰
              </button>
              <button class="btn btn-outline-secondary" onclick="resetFilters();">
                <i class="bi bi-arrow-clockwise"></i> ì´ˆê¸°í™”
              </button>
            </div>
          </div>
        </div>
        
        <!-- ê°ì‹¤ íƒ€ì… í…Œì´ë¸” -->
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover table-sm">
                <thead class="table-light">
                  <tr>
                    <th style="width: 5%;">ìˆœìœ„</th>
                    <th style="width: 13%;">í˜¸í…”ëª…</th>
                    <th style="width: 9%;">ì½”ë“œ</th>
                    <th style="width: 13%;">ê°ì‹¤ íƒ€ì…ëª…</th>
                    <th style="width: 13%;">í˜¸í…” ê°ì‹¤ëª…</th>
                    <th style="width: 7%;">ìµœëŒ€ì¸ì›</th>
                    <th style="width: 7%;">ê¸°ë³¸ìš”ê¸ˆ</th>
                    <th style="width: 7%;">ì¡°ì‹</th>
                    <th style="width: 7%;">ìƒíƒœ</th>
                    <th style="width: 13%;">ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody id="roomTypesList">
                  <!-- ë™ì ìœ¼ë¡œ ë¡œë“œ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div id="loadingSpinner" class="text-center py-5" style="display: none;">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ê°ì‹¤ íƒ€ì… ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ -->
  <div class="modal fade" id="roomTypeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">ê°ì‹¤ íƒ€ì… ë“±ë¡</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="roomTypeForm">
            <input type="hidden" id="roomTypeId">
            
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <h6 class="mb-3"><i class="bi bi-info-circle"></i> ê¸°ë³¸ ì •ë³´</h6>
            <div class="row g-3 mb-4">
              <div class="col-md-12">
                <label class="form-label">í˜¸í…” ì„ íƒ *</label>
                <select class="form-select" id="hotelId" required>
                  <option value="">í˜¸í…”ì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">ê°ì‹¤ íƒ€ì… ì½”ë“œ * (B2B ì½”ë“œ)</label>
                <input type="text" class="form-control" id="roomTypeCode" required placeholder="ì˜ˆ: DELUXE">
                <small class="text-muted">B2B ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©í•˜ëŠ” í‘œì¤€ ì½”ë“œ</small>
              </div>
              <div class="col-md-4">
                <label class="form-label">ê°ì‹¤ íƒ€ì…ëª… *</label>
                <input type="text" class="form-control" id="roomTypeName" required placeholder="ë””ëŸ­ìŠ¤ ë£¸">
              </div>
              <div class="col-md-4">
                <label class="form-label">ë¦¬ìŠ¤íŠ¸ ìˆœìœ„ *</label>
                <input type="number" class="form-control" id="displayOrder" required value="10" min="1" step="10">
                <small class="text-muted">ì‘ì„ìˆ˜ë¡ ë¨¼ì € í‘œì‹œ (ì˜ˆ: 10, 20, 30...)</small>
              </div>
              <div class="col-md-12">
                <label class="form-label">í˜¸í…” ê°ì‹¤ëª…</label>
                <input type="text" class="form-control" id="hotelRoomName" placeholder="Deluxe Ocean View Room">
                <small class="text-muted">í˜¸í…”ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì‹¤ì œ ê°ì‹¤ëª…</small>
              </div>
              <div class="col-md-12">
                <label class="form-label">ì„¤ëª…</label>
                <textarea class="form-control" id="description" rows="2" placeholder="ê°ì‹¤ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…"></textarea>
              </div>
            </div>
            
            <!-- ì¸ì› ì œí•œ -->
            <h6 class="mb-3"><i class="bi bi-people"></i> ì¸ì› ì œí•œ</h6>
            <div class="row g-3 mb-4">
              <div class="col-md-3">
                <label class="form-label">ìµœëŒ€ ì„±ì¸ ìˆ˜</label>
                <input type="number" class="form-control" id="maxAdults" value="2" min="1">
              </div>
              <div class="col-md-3">
                <label class="form-label">ìµœëŒ€ ì†Œì•„ ìˆ˜</label>
                <input type="number" class="form-control" id="maxChildren" value="1" min="0">
              </div>
              <div class="col-md-3">
                <label class="form-label">ìµœëŒ€ ìœ ì•„ ìˆ˜</label>
                <input type="number" class="form-control" id="maxInfants" value="1" min="0">
              </div>
              <div class="col-md-3">
                <label class="form-label">ìµœëŒ€ ì´ ì¸ì›</label>
                <input type="number" class="form-control" id="maxTotalOccupancy" value="3" min="1">
              </div>
            </div>
            
            <!-- ì¸ì› ì¶”ê°€ ìš”ê¸ˆ (ì‹œì¦Œ ë¬´ê´€ ê³ ì •ìš”ê¸ˆ) -->
            <h6 class="mb-3"><i class="bi bi-person-plus"></i> ì¸ì› ì¶”ê°€ ìš”ê¸ˆ (ì‹œì¦Œ ë¬´ê´€)</h6>
            <div class="alert alert-info" style="font-size: 0.65rem; padding: 0.5rem;">
              ğŸ’¡ <strong>ì•ˆë‚´:</strong> ê¸°ë³¸ ê°ì‹¤ ìš”ê¸ˆì€ ìš”ê¸ˆRAGì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤ (ì‹œì¦Œë³„/í”„ë¡œëª¨ì…˜ë³„). ì—¬ê¸°ëŠ” ì‹œì¦Œê³¼ ë¬´ê´€í•œ ë¶€ê°€ ìš”ê¸ˆë§Œ ë“±ë¡í•˜ì„¸ìš”.
            </div>
            <div class="row g-3 mb-4">
              <div class="col-md-4">
                <label class="form-label">ì¶”ê°€ ì„±ì¸ ìš”ê¸ˆ (USD/ë°•)</label>
                <input type="number" class="form-control" id="extraAdultRate" step="0.01" value="0" placeholder="30.00">
              </div>
              <div class="col-md-4">
                <label class="form-label">ì¶”ê°€ ì†Œì•„ ìš”ê¸ˆ (USD/ë°•)</label>
                <input type="number" class="form-control" id="extraChildRate" step="0.01" value="0" placeholder="15.00">
              </div>
              <div class="col-md-4">
                <label class="form-label">ì¶”ê°€ ìœ ì•„ ìš”ê¸ˆ (USD/ë°•)</label>
                <input type="number" class="form-control" id="extraInfantRate" step="0.01" value="0" placeholder="10.00">
              </div>
            </div>
            
            <!-- ì¡°ì‹ ì •ë³´ -->
            <h6 class="mb-3"><i class="bi bi-cup-hot"></i> ì¡°ì‹ ì •ë³´</h6>
            <div class="row g-3 mb-4">
              <div class="col-md-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="breakfastIncluded">
                  <label class="form-check-label" for="breakfastIncluded">
                    ì¡°ì‹ í¬í•¨
                  </label>
                </div>
              </div>
              <div class="col-md-3">
                <label class="form-label">ì¡°ì‹ ìš”ê¸ˆ - ì„±ì¸ (USD)</label>
                <input type="number" class="form-control" id="breakfastRateAdult" step="0.01" value="0" placeholder="20.00">
              </div>
              <div class="col-md-3">
                <label class="form-label">ì¡°ì‹ ìš”ê¸ˆ - ì†Œì•„ (USD)</label>
                <input type="number" class="form-control" id="breakfastRateChild" step="0.01" value="0" placeholder="10.00">
              </div>
              <div class="col-md-3">
                <label class="form-label">ì¡°ì‹ ìš”ê¸ˆ - ìœ ì•„ (USD)</label>
                <input type="number" class="form-control" id="breakfastRateInfant" step="0.01" value="0" placeholder="0">
              </div>
            </div>
            
            <!-- ë¶€ê°€ ì‹œì„¤ ìš”ê¸ˆ -->
            <h6 class="mb-3"><i class="bi bi-plus-circle"></i> ë¶€ê°€ ì‹œì„¤ ìš”ê¸ˆ</h6>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label class="form-label">ì—‘ìŠ¤íŠ¸ë¼ë² ë“œ ìš”ê¸ˆ (1ê°œë‹¹, USD)</label>
                <input type="number" class="form-control" id="extraBedRate" step="0.01" value="0" placeholder="50.00">
              </div>
              <div class="col-md-6">
                <label class="form-label">ë² ì´ë¹„ ì½”íŠ¸ ìš”ê¸ˆ (1ê°œë‹¹, USD)</label>
                <input type="number" class="form-control" id="babyCotRate" step="0.01" value="0" placeholder="0">
              </div>
            </div>
            
            <!-- ìƒíƒœ -->
            <div class="row g-3">
              <div class="col-md-12">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="isActive" checked>
                  <label class="form-check-label" for="isActive">
                    í™œì„±í™” (í™œì„±í™”ëœ ê°ì‹¤ íƒ€ì…ë§Œ ì˜ˆì•½ ê°€ëŠ¥)
                  </label>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="button" class="btn btn-primary" onclick="saveRoomType()">ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let currentRoomTypes = [];
    let hotels = [];
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ
    document.addEventListener('DOMContentLoaded', () => {
      loadHotels();
      loadRoomTypes();
    });
    
    // í˜¸í…” ëª©ë¡ ë¡œë“œ
    async function loadHotels() {
      try {
        const res = await fetch('/api/hotels?is_active=true');
        hotels = await res.json();
        
        // í•„í„° select
        const filterSelect = document.getElementById('filterHotel');
        filterSelect.innerHTML = '<option value="">ì „ì²´ í˜¸í…”</option>';
        hotels.forEach(hotel => {
          filterSelect.innerHTML += `<option value="${hotel.id}">${hotel.hotel_name} (${hotel.country})</option>`;
        });
        
        // ëª¨ë‹¬ select
        const modalSelect = document.getElementById('hotelId');
        modalSelect.innerHTML = '<option value="">í˜¸í…”ì„ ì„ íƒí•˜ì„¸ìš”</option>';
        hotels.forEach(hotel => {
          modalSelect.innerHTML += `<option value="${hotel.id}">${hotel.hotel_name} (${hotel.country})</option>`;
        });
      } catch (error) {
        console.error('í˜¸í…” ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }
    
    // ê°ì‹¤ íƒ€ì… ëª©ë¡ ë¡œë“œ
    async function loadRoomTypes() {
      const hotel_id = document.getElementById('filterHotel').value;
      const search = document.getElementById('filterSearch').value;
      const is_active = document.getElementById('filterActive').value;
      
      document.getElementById('loadingSpinner').style.display = 'block';
      document.getElementById('roomTypesList').innerHTML = '';
      
      try {
        const params = new URLSearchParams();
        if (hotel_id) params.append('hotel_id', hotel_id);
        if (search) params.append('search', search);
        if (is_active) params.append('is_active', is_active);
        
        const res = await fetch(`/api/room-types?${params}`);
        const roomTypes = await res.json();
        
        currentRoomTypes = roomTypes;
        renderRoomTypes(roomTypes);
      } catch (error) {
        console.error('ê°ì‹¤ íƒ€ì… ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('ê°ì‹¤ íƒ€ì… ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
      } finally {
        document.getElementById('loadingSpinner').style.display = 'none';
      }
    }
    
    // ê°ì‹¤ íƒ€ì… ëª©ë¡ ë Œë”ë§
    function renderRoomTypes(roomTypes) {
      const tbody = document.getElementById('roomTypesList');
      
      if (roomTypes.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9" class="text-center py-5">
              <i class="bi bi-inbox" style="font-size: 2rem; color: #6c757d;"></i>
              <p class="text-muted mt-3">ë“±ë¡ëœ ê°ì‹¤ íƒ€ì…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = roomTypes.map(rt => `
        <tr>
          <td class="text-center">
            <span class="badge bg-info">${rt.display_order || 999}</span>
          </td>
          <td>
            <strong>${rt.hotel_name || '-'}</strong>
            ${rt.country ? `<br><small class="text-muted">${rt.country}</small>` : ''}
          </td>
          <td><span class="badge bg-primary">${rt.room_type_code}</span></td>
          <td><strong>${rt.room_type_name}</strong></td>
          <td>${rt.hotel_room_name || '-'}</td>
          <td>
            ì„±ì¸ ${rt.max_adults || 2}<br>
            <small class="text-muted">ì†Œì•„ ${rt.max_children || 1} / ìœ ì•„ ${rt.max_infants || 1}</small>
          </td>
          <td>${rt.base_room_rate ? '$' + rt.base_room_rate : '-'}</td>
          <td>
            ${rt.breakfast_included ? 
              `<span class="badge bg-success">í¬í•¨</span>` : 
              `<span class="badge bg-secondary">ë³„ë„</span>`
            }
            ${rt.breakfast_rate_per_person > 0 ? `<br><small>$${rt.breakfast_rate_per_person}</small>` : ''}
          </td>
          <td>
            ${rt.is_active ? 
              '<span class="badge bg-success">í™œì„±</span>' : 
              '<span class="badge bg-secondary">ë¹„í™œì„±</span>'
            }
          </td>
          <td>
            <button class="btn btn-sm btn-outline-primary" onclick="editRoomType(${rt.id})">
              <i class="bi bi-pencil"></i> ìˆ˜ì •
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteRoomType(${rt.id})">
              <i class="bi bi-trash"></i> ì‚­ì œ
            </button>
          </td>
        </tr>
      `).join('');
    }
    
    // í•„í„° ì´ˆê¸°í™”
    function resetFilters() {
      document.getElementById('filterHotel').value = '';
      document.getElementById('filterSearch').value = '';
      document.getElementById('filterActive').value = 'true';
      loadRoomTypes();
    }
    
    // ê°ì‹¤ íƒ€ì… ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
    function openAddModal() {
      document.getElementById('modalTitle').textContent = 'ê°ì‹¤ íƒ€ì… ë“±ë¡';
      document.getElementById('roomTypeForm').reset();
      document.getElementById('roomTypeId').value = '';
      document.getElementById('isActive').checked = true;
      document.getElementById('maxAdults').value = 2;
      document.getElementById('maxChildren').value = 1;
      document.getElementById('maxInfants').value = 1;
      document.getElementById('maxTotalOccupancy').value = 3;
      document.getElementById('extraAdultRate').value = 0;
      document.getElementById('extraChildRate').value = 0;
      document.getElementById('extraInfantRate').value = 0;
      document.getElementById('breakfastRateAdult').value = 0;
      document.getElementById('breakfastRateChild').value = 0;
      document.getElementById('breakfastRateInfant').value = 0;
      document.getElementById('extraBedRate').value = 0;
      document.getElementById('babyCotRate').value = 0;
      document.getElementById('displayOrder').value = 10;
      
      new bootstrap.Modal(document.getElementById('roomTypeModal')).show();
    }
    
    // ê°ì‹¤ íƒ€ì… ìˆ˜ì •
    async function editRoomType(id) {
      try {
        const res = await fetch(`/api/room-types/${id}`);
        const rt = await res.json();
        
        document.getElementById('modalTitle').textContent = 'ê°ì‹¤ íƒ€ì… ìˆ˜ì •';
        document.getElementById('roomTypeId').value = rt.id;
        document.getElementById('hotelId').value = rt.hotel_id;
        document.getElementById('roomTypeCode').value = rt.room_type_code;
        document.getElementById('roomTypeName').value = rt.room_type_name;
        document.getElementById('hotelRoomName').value = rt.hotel_room_name || '';
        document.getElementById('description').value = rt.description || '';
        document.getElementById('maxAdults').value = rt.max_adults || 2;
        document.getElementById('maxChildren').value = rt.max_children || 1;
        document.getElementById('maxInfants').value = rt.max_infants || 1;
        document.getElementById('maxTotalOccupancy').value = rt.max_total_occupancy || 3;
        document.getElementById('extraAdultRate').value = rt.extra_adult_rate || 0;
        document.getElementById('extraChildRate').value = rt.extra_child_rate || 0;
        document.getElementById('extraInfantRate').value = rt.extra_infant_rate || 0;
        document.getElementById('breakfastIncluded').checked = rt.breakfast_included;
        document.getElementById('breakfastRateAdult').value = rt.breakfast_rate_adult || 0;
        document.getElementById('breakfastRateChild').value = rt.breakfast_rate_child || 0;
        document.getElementById('breakfastRateInfant').value = rt.breakfast_rate_infant || 0;
        document.getElementById('extraBedRate').value = rt.extra_bed_rate || 0;
        document.getElementById('babyCotRate').value = rt.baby_cot_rate || 0;
        document.getElementById('displayOrder').value = rt.display_order || 10;
        document.getElementById('isActive').checked = rt.is_active;
        
        new bootstrap.Modal(document.getElementById('roomTypeModal')).show();
      } catch (error) {
        console.error('ê°ì‹¤ íƒ€ì… ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('ê°ì‹¤ íƒ€ì… ì •ë³´ ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
      }
    }
    
    // ê°ì‹¤ íƒ€ì… ì €ì¥
    async function saveRoomType() {
      const id = document.getElementById('roomTypeId').value;
      const data = {
        hotel_id: document.getElementById('hotelId').value,
        room_type_code: document.getElementById('roomTypeCode').value,
        room_type_name: document.getElementById('roomTypeName').value,
        hotel_room_name: document.getElementById('hotelRoomName').value,
        description: document.getElementById('description').value,
        max_adults: parseInt(document.getElementById('maxAdults').value),
        max_children: parseInt(document.getElementById('maxChildren').value),
        max_infants: parseInt(document.getElementById('maxInfants').value),
        max_total_occupancy: parseInt(document.getElementById('maxTotalOccupancy').value),
        extra_adult_rate: parseFloat(document.getElementById('extraAdultRate').value) || 0,
        extra_child_rate: parseFloat(document.getElementById('extraChildRate').value) || 0,
        extra_infant_rate: parseFloat(document.getElementById('extraInfantRate').value) || 0,
        breakfast_included: document.getElementById('breakfastIncluded').checked,
        breakfast_rate_adult: parseFloat(document.getElementById('breakfastRateAdult').value) || 0,
        breakfast_rate_child: parseFloat(document.getElementById('breakfastRateChild').value) || 0,
        breakfast_rate_infant: parseFloat(document.getElementById('breakfastRateInfant').value) || 0,
        extra_bed_rate: parseFloat(document.getElementById('extraBedRate').value) || 0,
        baby_cot_rate: parseFloat(document.getElementById('babyCotRate').value) || 0,
        display_order: parseInt(document.getElementById('displayOrder').value) || 10,
        is_active: document.getElementById('isActive').checked
      };
      
      // í•„ìˆ˜ê°’ ì²´í¬
      if (!data.hotel_id || !data.room_type_code || !data.room_type_name) {
        alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        const url = id ? `/api/room-types/${id}` : '/api/room-types';
        const method = id ? 'PUT' : 'POST';
        
        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await res.json();
        
        if (result.error) {
          alert('ì €ì¥ ì‹¤íŒ¨: ' + result.error);
          return;
        }
        
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        bootstrap.Modal.getInstance(document.getElementById('roomTypeModal')).hide();
        loadRoomTypes();
      } catch (error) {
        console.error('ì €ì¥ ì‹¤íŒ¨:', error);
        alert('ì €ì¥ ì‹¤íŒ¨: ' + error.message);
      }
    }
    
    // ê°ì‹¤ íƒ€ì… ì‚­ì œ
    async function deleteRoomType(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì˜ˆì•½ì´ ìˆëŠ” ê²½ìš° ë¹„í™œì„±í™” ì²˜ë¦¬ë©ë‹ˆë‹¤.')) {
        return;
      }
      
      try {
        const res = await fetch(`/api/room-types/${id}`, { method: 'DELETE' });
        const result = await res.json();
        
        if (result.error) {
          alert('ì‚­ì œ ì‹¤íŒ¨: ' + result.error);
          return;
        }
        
        alert(result.message);
        loadRoomTypes();
      } catch (error) {
        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
        alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
      }
    }
  </script>
</body>
</html>
