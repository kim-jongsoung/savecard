<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || '확정서' %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background: #f5f5f5;
            color: #000;
            font-size: 9pt;
            line-height: 1.3;
        }
        
        .document-wrapper {
            max-width: 210mm;
            margin: 0.5rem auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 12mm;
        }
        
        @media print {
            body { 
                background: white; 
                margin: 0;
                font-size: 9pt;
            }
            .document-wrapper { 
                max-width: 100%;
                margin: 0;
                padding: 8mm;
                box-shadow: none;
            }
            .no-print { display: none !important; }
            @page { 
                size: A4; 
                margin: 8mm;
            }
            table { page-break-inside: avoid; }
        }
        
        .confirmation-header {
            text-align: center;
            border: 2px solid #000;
            padding: 6px;
            margin-bottom: 8px;
            background: #fff;
        }
        
        .doc-title {
            font-size: 20pt;
            font-weight: 700;
            margin: 0;
            padding: 3px 0;
            letter-spacing: 8px;
        }
        
        .doc-subtitle {
            font-size: 9pt;
            margin: 2px 0;
            color: #333;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 6px;
            font-size: 9pt;
        }
        
        table th, table td {
            border: 1px solid #333;
            padding: 3px 5px;
            text-align: left;
            vertical-align: middle;
        }
        
        table th {
            background: #e9ecef;
            font-weight: 600;
            text-align: center;
        }
        
        .section-title {
            background: #333;
            color: white;
            font-weight: 600;
            text-align: center;
            padding: 4px;
            font-size: 9pt;
        }
        
        .label-cell {
            background: #f8f9fa;
            font-weight: 600;
            width: 15%;
            text-align: center;
            font-size: 8.5pt;
        }
        
        .value-cell {
            width: 18%;
            font-size: 9pt;
        }
        
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .fw-bold { font-weight: 600; }
        
        .badge {
            display: inline-block;
            padding: 1px 6px;
            border-radius: 2px;
            font-size: 8pt;
            font-weight: 600;
        }
        
        .badge-success { background: #28a745; color: white; }
        .badge-warning { background: #ffc107; color: #000; }
        .badge-danger { background: #dc3545; color: white; }
        .badge-info { background: #17a2b8; color: white; }
        
        .btn-group {
            margin-top: 10px;
        }
        
        .price-highlight {
            background: #e7f3ff;
            font-weight: 600;
        }
        
        .total-price {
            background: #d4edda;
            font-weight: 700;
            font-size: 10pt;
        }
        
        .account-info {
            background: #fff3cd;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="document-wrapper">
        <!-- 헤더 -->
        <div class="confirmation-header">
            <div class="doc-title">확 정 서</div>
            <div class="doc-subtitle">럭스파인드 (LUXFIND)</div>
            <div class="doc-subtitle">예약번호: <strong><%= confirmation.reservation_number %></strong></div>
        </div>

        <!-- 기본 예약 정보 -->
        <table>
            <tr>
                <th colspan="6" class="section-title">기본 예약 정보</th>
            </tr>
            <tr>
                <td class="label-cell">상태</td>
                <td class="value-cell">
                    <% if (confirmation.reservation_status === 'confirmed') { %>
                        <span class="badge badge-success">확정</span>
                    <% } else if (confirmation.reservation_status === 'pending') { %>
                        <span class="badge badge-warning">대기</span>
                    <% } else if (confirmation.reservation_status === 'cancelled') { %>
                        <span class="badge badge-danger">취소</span>
                    <% } else { %>
                        <%= confirmation.reservation_status %>
                    <% } %>
                </td>
                <td class="label-cell">예약채널</td>
                <td class="value-cell"><%= confirmation.platform_name %></td>
                <td class="label-cell">기간</td>
                <td class="value-cell"><%= confirmation.nights %>박<%= confirmation.days %>일</td>
            </tr>
            <tr>
                <td class="label-cell">패키지명</td>
                <td colspan="5"><%= confirmation.package_name %></td>
            </tr>
            <tr>
                <td class="label-cell">출발일</td>
                <td class="value-cell"><%= new Date(confirmation.departure_date).toLocaleDateString('ko-KR') %></td>
                <td class="label-cell">귀국일</td>
                <td class="value-cell"><%= new Date(confirmation.return_date).toLocaleDateString('ko-KR') %></td>
                <td class="label-cell">인원</td>
                <td class="value-cell">성인 <%= confirmation.adult_count %><% if(confirmation.child_count > 0) { %>, 소아 <%= confirmation.child_count %><% } %><% if(confirmation.infant_count > 0) { %>, 유아 <%= confirmation.infant_count %><% } %></td>
            </tr>
        </table>

        <!-- 항공편 정보 -->
        <% if (confirmation.flight_info && (confirmation.flight_info.outbound_flight || confirmation.flight_info.inbound_flight)) { %>
        <table>
            <tr>
                <th colspan="6" class="section-title">항공편 정보</th>
            </tr>
            <tr>
                <td class="label-cell" rowspan="2">출국편</td>
                <td class="label-cell">편명</td>
                <td class="value-cell"><strong><%= confirmation.flight_info.outbound_flight || '-' %></strong></td>
                <td class="label-cell" rowspan="2">입국편</td>
                <td class="label-cell">편명</td>
                <td class="value-cell"><strong><%= confirmation.flight_info.inbound_flight || '-' %></strong></td>
            </tr>
            <tr>
                <td class="label-cell">출발/도착</td>
                <td class="value-cell"><%= confirmation.flight_info.outbound_departure_time || '-' %> / <%= confirmation.flight_info.outbound_arrival_time || '-' %></td>
                <td class="label-cell">출발/도착</td>
                <td class="value-cell"><%= confirmation.flight_info.inbound_departure_time || '-' %> / <%= confirmation.flight_info.inbound_arrival_time || '-' %></td>
            </tr>
        </table>
        <% } %>

        <!-- 호텔 정보 -->
        <% if (confirmation.hotel_name || confirmation.room_type) { %>
        <table>
            <tr>
                <th colspan="4" class="section-title">이용호텔</th>
            </tr>
            <tr>
                <td class="label-cell">호텔명</td>
                <td class="value-cell"><strong><%= confirmation.hotel_name || '-' %></strong></td>
                <td class="label-cell">룸타입</td>
                <td class="value-cell"><%= confirmation.room_type || '-' %></td>
            </tr>
        </table>
        <% } %>

        <!-- 고객 정보 -->
        <% if (confirmation.guests && confirmation.guests.length > 0) { %>
        <table>
            <tr>
                <th colspan="6" class="section-title">고객 정보</th>
            </tr>
            <tr>
                <th class="text-center" style="width: 8%;">구분</th>
                <th class="text-center" style="width: 15%;">한글이름</th>
                <th class="text-center" style="width: 22%;">영문이름</th>
                <th class="text-center" style="width: 12%;">생년월일</th>
                <th class="text-center" style="width: 15%;">연락처</th>
                <th class="text-center" style="width: 8%;">성별</th>
            </tr>
            <% confirmation.guests.forEach((guest, index) => { %>
            <tr>
                <td class="text-center"><%= guest.type || '성인' %></td>
                <td><%= guest.korean_name || '-' %></td>
                <td><%= guest.english_name || '-' %></td>
                <td class="text-center"><%= guest.birth_date ? new Date(guest.birth_date).toLocaleDateString('ko-KR') : '-' %></td>
                <td class="text-center"><%= guest.phone || '-' %></td>
                <td class="text-center"><%= guest.gender || '-' %></td>
            </tr>
            <% }); %>
        </table>
        <% } %>

        <!-- 일정 및 포함/불포함 사항 -->
        <% if (confirmation.itinerary || confirmation.inclusions || confirmation.exclusions) { %>
        <table>
            <tr>
                <th colspan="2" class="section-title">일정 및 포함/불포함 사항</th>
            </tr>
            <% if (confirmation.itinerary) { %>
            <tr>
                <td class="label-cell" style="width: 15%;">일정</td>
                <td style="white-space: pre-line; padding: 6px;"><%= confirmation.itinerary %></td>
            </tr>
            <% } %>
            <% if (confirmation.inclusions) { %>
            <tr>
                <td class="label-cell" style="width: 15%;">포함사항</td>
                <td style="white-space: pre-line; padding: 6px;"><%= confirmation.inclusions %></td>
            </tr>
            <% } %>
            <% if (confirmation.exclusions) { %>
            <tr>
                <td class="label-cell" style="width: 15%;">불포함사항</td>
                <td style="white-space: pre-line; padding: 6px;"><%= confirmation.exclusions %></td>
            </tr>
            <% } %>
        </table>
        <% } %>

        <!-- 특별 요청사항 -->
        <% if (confirmation.special_requests) { %>
        <table>
            <tr>
                <th colspan="2" class="section-title" style="background: #dc3545;">특별 요청사항</th>
            </tr>
            <tr>
                <td colspan="2" style="white-space: pre-line; padding: 6px; background: #fff3cd;"><strong>⚠️ <%= confirmation.special_requests %></strong></td>
            </tr>
        </table>
        <% } %>

        <!-- 금액 정보 -->
        <table>
            <tr>
                <th colspan="4" class="section-title">금액 정보</th>
            </tr>
            
            <!-- 인원별 판매가 -->
            <% if (confirmation.adult_count > 0) { %>
            <tr class="price-highlight">
                <td class="label-cell">성인</td>
                <td class="value-cell text-right"><%= confirmation.adult_count %>명 × ₩<%= (confirmation.adult_price || 0).toLocaleString() %></td>
                <td class="label-cell">소계</td>
                <td class="value-cell text-right"><strong>₩<%= ((confirmation.adult_price || 0) * confirmation.adult_count).toLocaleString() %></strong></td>
            </tr>
            <% } %>
            
            <% if (confirmation.child_count > 0) { %>
            <tr class="price-highlight">
                <td class="label-cell">소아</td>
                <td class="value-cell text-right"><%= confirmation.child_count %>명 × ₩<%= (confirmation.child_price || 0).toLocaleString() %></td>
                <td class="label-cell">소계</td>
                <td class="value-cell text-right"><strong>₩<%= ((confirmation.child_price || 0) * confirmation.child_count).toLocaleString() %></strong></td>
            </tr>
            <% } %>
            
            <% if (confirmation.infant_count > 0) { %>
            <tr class="price-highlight">
                <td class="label-cell">유아</td>
                <td class="value-cell text-right"><%= confirmation.infant_count %>명 × ₩<%= (confirmation.infant_price || 0).toLocaleString() %></td>
                <td class="label-cell">소계</td>
                <td class="value-cell text-right"><strong>₩<%= ((confirmation.infant_price || 0) * confirmation.infant_count).toLocaleString() %></strong></td>
            </tr>
            <% } %>
            
            <!-- 금액 변동 추가 사항 -->
            <% if (confirmation.adjustments && confirmation.adjustments.length > 0) { %>
                <% confirmation.adjustments.forEach((adj, index) => { %>
                <tr>
                    <td class="label-cell">금액변동</td>
                    <td class="value-cell"><%= adj.description || '금액 변동' %></td>
                    <td class="label-cell">금액</td>
                    <td class="value-cell text-right <%= (adj.amount || 0) >= 0 ? 'text-success' : 'text-danger' %>">
                        <strong><%= (adj.amount || 0) >= 0 ? '+' : '' %>₩<%= (adj.amount || 0).toLocaleString() %></strong>
                    </td>
                </tr>
                <% }); %>
            <% } %>
            
            <!-- 총 판매가 -->
            <tr class="total-price">
                <td colspan="3" class="text-center"><strong>총 판매가</strong></td>
                <td class="text-right"><strong>₩<%= confirmation.total_amount.toLocaleString() %></strong></td>
            </tr>
            
            <!-- 입금 계좌 정보 -->
            <tr class="account-info">
                <td class="label-cell">입금계좌</td>
                <td colspan="3">
                    <strong>신한은행 140-014-014440 (주)럭스파인드</strong>
                </td>
            </tr>
        </table>

        <!-- 버튼 영역 -->
        <div class="text-center mt-3 no-print btn-group">
            <button class="btn btn-primary" onclick="window.print()" style="min-width: 150px;">
                <i class="fas fa-print me-1"></i>인쇄
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
