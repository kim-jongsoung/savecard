<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ν”½μ—… λ°μ΄ν„° ν…μ¤νΈ</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .box { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .arrival { background: #e3f2fd; }
    .departure { background: #fce4ec; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>π§ ν”½μ—… λ°μ΄ν„° ν…μ¤νΈ</h1>
  
  <div>
    <h2>ν„μ¬ λ‹¬: <span id="currentMonth"></span></h2>
    <button onclick="loadData()">λ°μ΄ν„° μƒλ΅κ³ μΉ¨</button>
  </div>
  
  <h3>π“ κ²°κ³Ό</h3>
  <div id="result"></div>
  
  <h3>π“ μ›λ³Έ λ°μ΄ν„° (JSON)</h3>
  <pre id="rawData"></pre>

  <script>
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth() + 1;
    
    document.getElementById('currentMonth').textContent = `${year}λ…„ ${month}μ›”`;
    
    async function loadData() {
      try {
        const url = `/pickup/api/calendar?year=${year}&month=${month}`;
        console.log('π” API νΈμ¶:', url);
        
        const res = await fetch(url);
        const data = await res.json();
        
        console.log('β… μ‘λ‹µ λ°›μ:', data);
        
        // μ›λ³Έ λ°μ΄ν„° ν‘μ‹
        document.getElementById('rawData').textContent = JSON.stringify(data, null, 2);
        
        // κ²°κ³Ό ν‘μ‹
        let html = '';
        
        html += `<div class="box">`;
        html += `<strong>κ³µν•­ ν”½μ—… (arrivals):</strong> ${data.arrivals.length}κ±΄<br>`;
        html += `<strong>νΈν…” ν”½μ—… (departures):</strong> ${data.departures.length}κ±΄`;
        html += `</div>`;
        
        if (data.arrivals.length === 0 && data.departures.length === 0) {
          html += `<div class="box" style="background:#fff3cd;">β οΈ λ°μ΄ν„°κ°€ μ—†μµλ‹λ‹¤. μ‹ κ· μμ•½μ„ λ“±λ΅ν•΄μ£Όμ„Έμ”.</div>`;
        }
        
        // κ³µν•­ ν”½μ—…
        data.arrivals.forEach(p => {
          html += `
            <div class="box arrival">
              <strong>π›¬ κ³µν•­ ν”½μ—… #${p.id}</strong><br>
              λ‚ μ§: ${p.guam_arrival_date} ${p.guam_arrival_time}<br>
              κ³ κ°: ${p.customer_name} (${p.passenger_count}λ…)<br>
              νΈν…”: ${p.hotel_name}<br>
              μ—…μ²΄: ${p.agency_name || '-'}
            </div>
          `;
        });
        
        // νΈν…” ν”½μ—…
        data.departures.forEach(p => {
          html += `
            <div class="box departure">
              <strong>π¨ νΈν…” ν”½μ—… #${p.id}</strong><br>
              λ‚ μ§: ${p.hotel_pickup_date} ${p.hotel_pickup_time}<br>
              κ³ κ°: ${p.customer_name} (${p.passenger_count}λ…)<br>
              νΈν…”: ${p.hotel_name}<br>
              μ—…μ²΄: ${p.agency_name || '-'}
              ${p.is_early_morning ? '<br>π™ <strong>μƒλ²½ λΉ„ν–‰κΈ°</strong>' : ''}
            </div>
          `;
        });
        
        document.getElementById('result').innerHTML = html;
        
      } catch (error) {
        console.error('β μ¤λ¥:', error);
        document.getElementById('result').innerHTML = 
          `<div class="box" style="background:#ffebee;">β μ¤λ¥ λ°μƒ: ${error.message}</div>`;
      }
    }
    
    // μλ™ λ΅λ“
    loadData();
  </script>
</body>
</html>
