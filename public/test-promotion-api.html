<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í”„ë¡œëª¨ì…˜ API í…ŒìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; font-family: monospace; }
        .result { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 10px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        pre { margin: 0; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ” í”„ë¡œëª¨ì…˜ API í…ŒìŠ¤íŠ¸</h2>
        
        <div class="card mb-4">
            <div class="card-header"><strong>1. í”„ë¡œëª¨ì…˜ ëª©ë¡ ì¡°íšŒ</strong></div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="testPromoList()">í”„ë¡œëª¨ì…˜ ëª©ë¡ ì¡°íšŒ</button>
                <div id="result1" class="result" style="display:none;"></div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header"><strong>2. ë£¸íƒ€ì…ë³„ í”„ë¡œëª¨ì…˜ ì¡°íšŒ (ìƒˆ API)</strong></div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-3">
                        <label>Room Type ID</label>
                        <input type="number" class="form-control" id="roomTypeId" placeholder="ì˜ˆ: 8">
                    </div>
                    <div class="col-md-3">
                        <label>Check In</label>
                        <input type="date" class="form-control" id="checkIn">
                    </div>
                    <div class="col-md-3">
                        <label>Check Out</label>
                        <input type="date" class="form-control" id="checkOut">
                    </div>
                    <div class="col-md-3">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary w-100" onclick="testRoomTypePromos()">ì¡°íšŒ</button>
                    </div>
                </div>
                <div id="result2" class="result" style="display:none;"></div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header"><strong>3. í”„ë¡œëª¨ì…˜ ìš”ê¸ˆ ë°ì´í„° í™•ì¸</strong></div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-6">
                        <label>Promotion ID</label>
                        <input type="number" class="form-control" id="promoId" placeholder="ì˜ˆ: 1">
                    </div>
                    <div class="col-md-6">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary w-100" onclick="testPromoRates()">ìš”ê¸ˆ ì¡°íšŒ</button>
                    </div>
                </div>
                <div id="result3" class="result" style="display:none;"></div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header"><strong>4. í™œì„± ë£¸íƒ€ì… ëª©ë¡</strong></div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="testRoomTypes()">ë£¸íƒ€ì… ëª©ë¡ ì¡°íšŒ</button>
                <div id="result4" class="result" style="display:none;"></div>
            </div>
        </div>
    </div>
    
    <script>
        // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ˆê¸°í™”
        const today = new Date().toISOString().split('T')[0];
        const tomorrow = new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        document.getElementById('checkIn').value = today;
        document.getElementById('checkOut').value = tomorrow;
        
        async function testPromoList() {
            const result = document.getElementById('result1');
            result.style.display = 'block';
            result.className = 'result';
            result.innerHTML = 'ğŸ”„ ë¡œë”© ì¤‘...';
            
            try {
                const res = await fetch('/api/promotions');
                const data = await res.json();
                
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… ì„±ê³µ!</strong><br>
                    ì´ ${data.promotions?.length || 0}ê°œì˜ í”„ë¡œëª¨ì…˜<br><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                result.className = 'result error';
                result.innerHTML = `<strong>âŒ ì˜¤ë¥˜</strong><br><pre>${error.message}</pre>`;
            }
        }
        
        async function testRoomTypePromos() {
            const roomTypeId = document.getElementById('roomTypeId').value;
            const checkIn = document.getElementById('checkIn').value;
            const checkOut = document.getElementById('checkOut').value;
            const result = document.getElementById('result2');
            
            if (!roomTypeId || !checkIn || !checkOut) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            result.style.display = 'block';
            result.className = 'result';
            result.innerHTML = 'ğŸ”„ ë¡œë”© ì¤‘...';
            
            try {
                const url = `/api/promotions/room-type/${roomTypeId}/rates?checkIn=${checkIn}&checkOut=${checkOut}`;
                console.log('ğŸ”— API URL:', url);
                
                const res = await fetch(url);
                const data = await res.json();
                
                if (data.success) {
                    result.className = 'result success';
                    result.innerHTML = `
                        <strong>âœ… ì„±ê³µ!</strong><br>
                        ì ìš© ê°€ëŠ¥í•œ í”„ë¡œëª¨ì…˜: ${data.promotions?.length || 0}ê°œ<br>
                        ì²´í¬ì¸: ${data.check_in}<br>
                        ì²´í¬ì•„ì›ƒ: ${data.check_out}<br>
                        ìˆ™ë°•ì¼ìˆ˜: ${data.nights}ë°•<br><br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    result.className = 'result error';
                    result.innerHTML = `
                        <strong>âŒ ì‹¤íŒ¨</strong><br>
                        ${data.message || data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}<br><br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                result.className = 'result error';
                result.innerHTML = `<strong>âŒ ì˜¤ë¥˜</strong><br><pre>${error.message}</pre>`;
            }
        }
        
        async function testPromoRates() {
            const promoId = document.getElementById('promoId').value;
            const result = document.getElementById('result3');
            
            if (!promoId) {
                alert('Promotion IDë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            result.style.display = 'block';
            result.className = 'result';
            result.innerHTML = 'ğŸ”„ ë¡œë”© ì¤‘...';
            
            try {
                const res = await fetch(`/api/promotions/${promoId}/rates`);
                const data = await res.json();
                
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… ì„±ê³µ!</strong><br>
                    ì´ ${data.length || 0}ê°œì˜ ìš”ê¸ˆ ë°ì´í„°<br><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                result.className = 'result error';
                result.innerHTML = `<strong>âŒ ì˜¤ë¥˜</strong><br><pre>${error.message}</pre>`;
            }
        }
        
        async function testRoomTypes() {
            const result = document.getElementById('result4');
            result.style.display = 'block';
            result.className = 'result';
            result.innerHTML = 'ğŸ”„ ë¡œë”© ì¤‘...';
            
            try {
                const res = await fetch('/api/room-types?is_active=true');
                const data = await res.json();
                
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… ì„±ê³µ!</strong><br>
                    ì´ ${data.length || 0}ê°œì˜ í™œì„± ë£¸íƒ€ì…<br><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                result.className = 'result error';
                result.innerHTML = `<strong>âŒ ì˜¤ë¥˜</strong><br><pre>${error.message}</pre>`;
            }
        }
    </script>
</body>
</html>
